<!DOCTYPE html><html lang="zh-Hans"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.00cb9de403c98636c1d7.css" id="gatsby-global-css">@import url(https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&family=Ubuntu+Mono&display=swap);@import url(https://fonts.googleapis.com/css2?family=family=PT+Mono&display=swap);@import url(https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@200&display=swap);code[class*=language-],pre[class*=language-]{color:#393a34;font-family:Consolas,Bitstream Vera Sans Mono,Courier New,Courier,monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:.9em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre>code[class*=language-]{font-size:1em}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#b3d4fc}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border:1px solid #ddd;background-color:#fff}:not(pre)>code[class*=language-]{padding:1px .2em;background:#f8f8f8;border:1px solid #ddd}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#998;font-style:italic}.token.namespace{opacity:.7}.token.attr-value,.token.string{color:#e3116c}.token.operator,.token.punctuation{color:#393a34}.token.boolean,.token.constant,.token.entity,.token.inserted,.token.number,.token.property,.token.regex,.token.symbol,.token.url,.token.variable{color:#36acaa}.language-autohotkey .token.selector,.token.atrule,.token.attr-name,.token.keyword{color:#00a4db}.language-autohotkey .token.tag,.token.deleted,.token.function{color:#9a050f}.language-autohotkey .token.keyword,.token.selector,.token.tag{color:#00009f}.token.bold,.token.function,.token.important{font-weight:700}.token.italic{font-style:italic}@font-face{font-family:CELESTE;font-weight:400;font-style:normal;src:url(/static/s-regular-9385fd1fd5c61b2cc614a0be00313964.woff2) format("woff2"),url(/static/s-regular-c009677c4a2159ee7f31bf4bc1e7e7a6.woff) format("woff"),url(/static/s-regular-6c9821a2719dc9504f7e81fa9cc55bbf.ttf) format("opentype"),local(Celeste)}@font-face{font-family:CELESTE;font-weight:400;font-style:italic;src:url(/static/s-italic-9706ea536e833c7f98205f87202df48e.woff2) format("woff2"),url(/static/s-italic-fd72769f97e24173ac034d353aa1ebe8.woff) format("woff"),url(/static/s-italic-4412ef3337fd1eff88b7b0910eac0dcc.ttf) format("opentype"),local(Celeste)}@font-face{font-family:CELESTE;font-weight:700;font-style:normal;src:url(/static/s-bold-f52d2380d3f5875990471dffa2dfa2cb.woff2) format("woff2"),url(/static/s-bold-a331fe095a1bb65f576f95f99d9f6b55.woff) format("woff"),url(/static/s-bold-854de931719c78ccceba7db15e8fcbc9.ttf) format("opentype"),local(Celeste)}@font-face{font-family:CELESTE;font-weight:700;font-style:italic;src:url(/static/s-bolditalic-88ffe17e4056b6e1c6e82066d635038d.woff2) format("woff2"),url(/static/s-bolditalic-76f64c7f336514821205b11143f80d2c.woff) format("woff"),url(/static/s-bolditalic-4404e053c83660e45626cfdde1e90390.ttf) format("opentype"),local(Celeste)}/*! normalize.css v4.0.0 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,select,textarea{font:inherit}optgroup{font-weight:700}button,input,select{overflow:visible}button,input,select,textarea{margin:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{cursor:pointer}[disabled]{cursor:default}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}button:-moz-focusring,input:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}html{line-height:1.3;-webkit-font-smoothing:subpixel-antialiased}ol,ul{padding-left:2em}blockquote,figure{margin-left:2em;margin-right:2em}address{font-style:inherit}pre{overflow:auto;white-space:pre;word-wrap:normal}a{text-decoration:inherit}em:lang(ja),em:lang(zh){-moz-text-emphasis:filled circle;-webkit-text-emphasis:filled circle;text-emphasis:filled circle;-moz-text-emphasis-position:under;-webkit-text-emphasis-position:under;text-emphasis-position:under;font-style:inherit;border-bottom:0 dotted;padding-bottom:0}em:lang(ja){-moz-text-emphasis:filled sesame;-webkit-text-emphasis:filled sesame;text-emphasis:filled sesame;-moz-text-emphasis-position:over;-webkit-text-emphasis-position:over;text-emphasis-position:over}dfn:lang(ja),dfn:lang(zh){font-weight:inherit;font-style:inherit;font-weight:bolder}cite:lang(ja),cite:lang(zh){font-style:inherit}q{quotes:"\201C" "\201D" "\2018" "\2019" "\201C" "\201D" "\2018" "\2019" "\201C" "\201D" "\2018" "\2019"}q:lang(zh){quotes:"\300C" "\300D" "\300E" "\300F" "\300C" "\300D" "\300E" "\300F" "\300C" "\300D" "\300E" "\300F"}q:lang(en),q:lang(zh-CN){quotes:"\201C" "\201D" "\2018" "\2019" "\201C" "\201D" "\2018" "\2019" "\201C" "\201D" "\2018" "\2019"}q:lang(en-GB){quotes:"\2018" "\2019" "\201C" "\201D" "\2018" "\2019" "\201C" "\201D" "\2018" "\2019" "\201C" "\201D"}q:before{content:open-quote}q:after{content:close-quote}q:lang(ja):after,q:lang(ja):before{content:none}code,kbd,pre,samp{font-family:monospace,monospace,sans-serif}i:lang(ja),i:lang(zh),var:lang(ja),var:lang(zh){font-family:cursive,serif;font-style:inherit}.han-js-rendered del+del.adjacent,.han-js-rendered del+s.adjacent,.han-js-rendered ins.adjacent,.han-js-rendered s+del.adjacent,.han-js-rendered s+s.adjacent,.han-js-rendered u.adjacent,del+del,del+s,ins+ins,ins+u,s+del,s+s,u+ins,u+u{margin-left:.125em}ins,u{padding-bottom:.05em;border-bottom:1px solid;text-decoration:none}ruby rtc rt{display:inline;font-size:inherit}ruby.mps,ruby.zhuyin{display:ruby;-webkit-ruby-position:inter-character;ruby-position:inter-character}ruby.mps>rt,ruby.zhuyin>rt{transform:scale(.8);transform-origin:left center;font-size:.5em}ruby.mps>rt:empty,ruby.zhuyin>rt:empty{display:none}.han-js-rendered del+del,.han-js-rendered del+s,.han-js-rendered ins+ins,.han-js-rendered ins+u,.han-js-rendered s+del,.han-js-rendered s+s,.han-js-rendered u+ins,.han-js-rendered u+u{margin-left:auto}.han-js-rendered em:lang(ja),.han-js-rendered em:lang(zh){padding-bottom:auto;border-bottom-width:0}.no-textemphasis em:lang(ja),.no-textemphasis em:lang(zh){line-height:2}.no-textemphasis em:lang(ja) h-char,.no-textemphasis em:lang(zh) h-char{position:relative;font-style:inherit}.no-textemphasis em:lang(ja) h-char:after,.no-textemphasis em:lang(zh) h-char:after{-moz-text-emphasis:none;-webkit-text-emphasis:none;text-emphasis:none;font-style:normal;font-weight:400;line-height:normal;text-decoration:none;transform:scale(.5);position:absolute;left:50%;top:0;margin-left:-250%;overflow:hidden;display:inline-block;height:1em;width:500%;line-height:1;text-align:center;text-indent:0;font-family:Georgia,Times New Roman,Arial!important}em:lang(ja) h-char.biaodian,em:lang(ja) h-char.punct,em:lang(zh) h-char.biaodian,em:lang(zh) h-char.punct{-moz-text-emphasis:none;-webkit-text-emphasis:none;text-emphasis:none}.no-textemphasis em:lang(ja) h-char.biaodian:after,.no-textemphasis em:lang(ja) h-char.punct:after,.no-textemphasis em:lang(zh) h-char.biaodian:after,.no-textemphasis em:lang(zh) h-char.punct:after{content:none!important}.no-textemphasis em:lang(zh) h-char:after{margin-top:1em;content:"\25CF"}.no-textemphasis em:lang(ja) h-char:after{margin-top:-.7em;content:"\FE45"}h-ruby.zhuyin h-zhuyin,ruby.mps h-zhuyin,ruby.zhuyin h-zhuyin{position:relative;letter-spacing:0}h-ruby.zhuyin h-diao,ruby.mps h-diao,ruby.zhuyin h-diao{position:absolute;right:-.9em;bottom:.5em;display:block;font-size:1.5em}h-ruby.zhuyin h-diao h-char,ruby.mps h-diao h-char,ruby.zhuyin h-diao h-char{-ms-writing-mode:lr-tb;writing-mode:horizontal-tb}h-ruby.zhuyin [diao=˙] h-diao,ruby.mps [diao=˙] h-diao,ruby.zhuyin [diao=˙] h-diao{top:-.3em;right:auto;bottom:auto;left:0;font-size:1em}h-ruby.zhuyin [diao=󳆴] h-diao,h-ruby.zhuyin [diao=󳆵] h-diao,h-ruby.zhuyin [diao=󳆶] h-diao,h-ruby.zhuyin [diao=󳆷] h-diao,h-ruby.zhuyin [diao^=ㆴ] h-diao,h-ruby.zhuyin [diao^=ㆵ] h-diao,h-ruby.zhuyin [diao^=ㆶ] h-diao,h-ruby.zhuyin [diao^=ㆷ] h-diao,ruby.mps [diao=󳆴] h-diao,ruby.mps [diao=󳆵] h-diao,ruby.mps [diao=󳆶] h-diao,ruby.mps [diao=󳆷] h-diao,ruby.mps [diao^=ㆴ] h-diao,ruby.mps [diao^=ㆵ] h-diao,ruby.mps [diao^=ㆶ] h-diao,ruby.mps [diao^=ㆷ] h-diao,ruby.zhuyin [diao=󳆴] h-diao,ruby.zhuyin [diao=󳆵] h-diao,ruby.zhuyin [diao=󳆶] h-diao,ruby.zhuyin [diao=󳆷] h-diao,ruby.zhuyin [diao^=ㆴ] h-diao,ruby.zhuyin [diao^=ㆵ] h-diao,ruby.zhuyin [diao^=ㆶ] h-diao,ruby.zhuyin [diao^=ㆷ] h-diao{right:-1em;bottom:-.125em;font-size:1em}h-ru[annotation]{position:relative;display:inline-table;border-collapse:collapse;border-spacing:0;line-height:1.1;text-align:center;vertical-align:1em}h-ru[annotation]>h-ru[annotation]{vertical-align:-.1em}h-ru[annotation]>h-ru,h-ru[annotation]>rb,h-ru[annotation]>rt{line-height:1;text-align:center}h-ru[annotation]>rt{display:table-header-group;height:1em;font-size:.5em;white-space:nowrap;word-break:normal}h-ru[annotation]>rt:after,h-ru[annotation]>rt:before{content:"\2006"}h-ru[order="0"]>rt,h-ruby[rightangle][doubleline] h-ru[order="0"]>rt{display:table-header-group}h-ru[order="1"]>rt,h-ruby[rightangle][doubleline] h-ru[order="1"]>rt,h-ruby[rightangle] h-ru[order="0"]>rt{display:table-footer-group}h-ru[order="0"]>h-ru[order="1"]{vertical-align:.15em}h-ruby[rightangle][doubleline] h-ru[order="0"] rt{line-height:1.5}h-ruby[rightangle][doubleline] h-ru[annotation]{vertical-align:.5em}[zhuyin] h-zhuyin{-moz-text-emphasis:none;-webkit-text-emphasis:none;text-emphasis:none;font-style:normal;font-weight:400;line-height:normal;text-decoration:none;text-indent:0;position:relative;display:inline-block;height:1em;width:.4em;vertical-align:text-top}[zhuyin] h-zhuyin>*{transform:scale(.4);transform-origin:left top;display:inline-block}[zhuyin] h-yin{left:0;height:1em;vertical-align:top}[zhuyin] h-diao,[zhuyin] h-yin{position:absolute;line-height:1}[zhuyin] h-diao{bottom:0;right:-.9em}[zhuyin] h-diao:empty,[zhuyin] h-yin:empty{display:none}[zhuyin] [length="0"]{margin-right:0}[zhuyin] [length="0"] h-zhuyin{display:none}[zhuyin] [length="1"] h-yin{top:.3em}[zhuyin] [length="1"] h-diao{bottom:0}[zhuyin] [length="2"] h-yin{top:.05em}[zhuyin] [length="2"] h-diao{bottom:-.3em}[zhuyin] [length="3"] h-yin{top:-.05em;line-height:.85}[zhuyin] [length="3"] h-diao{bottom:-.35em}[zhuyin] [diao=˙] h-diao{top:0;right:auto;bottom:auto;left:.06em}[zhuyin] [diao=˙] [length="1"] h-diao{top:.15em}[zhuyin] [diao=˙] [length="2"] h-diao{top:-.05em}[zhuyin] [diao=˙] [length="3"] h-diao{top:-.2em}[zhuyin] [diao=˪] h-diao,[zhuyin] [diao=˫] h-diao{transform:scale(.6);transform-origin:left top}[zhuyin] [diao=󳆴] h-diao,[zhuyin] [diao=󳆵] h-diao,[zhuyin] [diao=󳆶] h-diao,[zhuyin] [diao=󳆷] h-diao,[zhuyin] [diao^=ㆴ] h-diao,[zhuyin] [diao^=ㆵ] h-diao,[zhuyin] [diao^=ㆶ] h-diao,[zhuyin] [diao^=ㆷ] h-diao{bottom:-.6em;margin-right:.3em}[zhuyin]{margin-right:.2em;display:inline-block;line-height:1.8}[rightangle] h-ru[annotation]{vertical-align:0;line-height:1}[rightangle] rt:after{content:"";display:inline-block;width:1.2em}h-ru h-ru[zhuyin]{margin-top:-.4em;margin-bottom:-.2em;line-height:1.8}h-jinze,h-word{display:inline-block;text-indent:0}@font-face{font-family:Han Heiti;src:local("Hiragino Sans GB"),local("Lantinghei TC Extralight"),local("Lantinghei SC Extralight"),local(FZLTXHB--B51-0),local(FZLTZHK--GBK1-0),local(".PingFang SC Light"),local(".PingFang TC Light"),local(".PingFang-SC-Light"),local(".PingFang-TC-Light"),local(".PingFang SC"),local(".PingFang TC"),local("Heiti SC Light"),local(STHeitiSC-Light),local("Heiti SC"),local("Heiti TC Light"),local(STHeitiTC-Light),local("Heiti TC"),local("Microsoft Yahei"),local("Microsoft Jhenghei"),local("Noto Sans CJK KR"),local("Noto Sans CJK JP"),local("Noto Sans CJK SC"),local("Noto Sans CJK TC"),local("Source Han Sans K"),local("Source Han Sans KR"),local("Source Han Sans JP"),local("Source Han Sans CN"),local("Source Han Sans HK"),local("Source Han Sans TW"),local("Source Han Sans TWHK"),local("Droid Sans Fallback")}@font-face{unicode-range:U+4e00-9fff,U+3400-4db5,U+20000-2a6d6,U+2a700-2b734,U+2b740-2b81d,U+fa0e-fa0f,U+fa11,U+fa13-fa14,U+fa1f,U+fa21,U+fa23,U+fa24,U+fa27-fa29,U+3040-309f,U+30a0-30ff,U+3099-309e,U+ff66-ff9f,U+3007,U+31c0-31e3,U+2f00-2fd5,U+2e80-2ef3;font-family:Han Heiti;src:local(YuGothic),local("Hiragino Kaku Gothic ProN"),local("Hiragino Kaku Gothic Pro")}@font-face{font-family:Han Heiti CNS;src:local(".PingFang TC Light"),local(".PingFang-TC-Light"),local(".PingFang TC"),local("Heiti TC Light"),local(STHeitiTC-Light),local("Heiti TC"),local("Lantinghei TC Extralight"),local(FZLTXHB--B51-0),local("Lantinghei TC"),local("Microsoft Jhenghei"),local("Microsoft Yahei"),local("Noto Sans CJK TC"),local("Source Han Sans TC"),local("Source Han Sans TW"),local("Source Han Sans TWHK"),local("Source Han Sans HK"),local("Droid Sans Fallback")}@font-face{font-family:Han Heiti GB;src:local("Hiragino Sans GB"),local(".PingFang SC Light"),local(".PingFang-SC-Light"),local(".PingFang SC"),local("Lantinghei SC Extralight"),local(FZLTXHK--GBK1-0),local("Lantinghei SC"),local("Heiti SC Light"),local(STHeitiSC-Light),local("Heiti SC"),local("Microsoft Yahei"),local("Noto Sans CJK SC"),local("Source Han Sans SC"),local("Source Han Sans CN"),local("Droid Sans Fallback")}@font-face{font-family:Han Heiti;font-weight:600;src:local("Hiragino Sans GB W6"),local(HiraginoSansGB-W6),local("Lantinghei TC Demibold"),local("Lantinghei SC Demibold"),local(FZLTZHB--B51-0),local(FZLTZHK--GBK1-0),local(".PingFang-SC-Semibold"),local(".PingFang-TC-Semibold"),local("Heiti SC Medium"),local("STHeitiSC-Medium"),local("Heiti SC"),local("Heiti TC Medium"),local("STHeitiTC-Medium"),local("Heiti TC"),local("Microsoft YaHei Bold"),local("Microsoft Jhenghei Bold"),local(MicrosoftYaHei-Bold),local(MicrosoftJhengHeiBold),local("Microsoft YaHei"),local("Microsoft Jhenghei"),local("Noto Sans CJK KR Bold"),local("Noto Sans CJK JP Bold"),local("Noto Sans CJK SC Bold"),local("Noto Sans CJK TC Bold"),local(NotoSansCJKkr-Bold),local(NotoSansCJKjp-Bold),local(NotoSansCJKsc-Bold),local(NotoSansCJKtc-Bold),local("Source Han Sans K Bold"),local(SourceHanSansK-Bold),local("Source Han Sans K"),local("Source Han Sans KR Bold"),local("Source Han Sans JP Bold"),local("Source Han Sans CN Bold"),local("Source Han Sans HK Bold"),local("Source Han Sans TW Bold"),local("Source Han Sans TWHK Bold"),local("SourceHanSansKR-Bold"),local("SourceHanSansJP-Bold"),local("SourceHanSansCN-Bold"),local("SourceHanSansHK-Bold"),local("SourceHanSansTW-Bold"),local("SourceHanSansTWHK-Bold"),local("Source Han Sans KR"),local("Source Han Sans CN"),local("Source Han Sans HK"),local("Source Han Sans TW"),local("Source Han Sans TWHK")}@font-face{unicode-range:U+4e00-9fff,U+3400-4db5,U+20000-2a6d6,U+2a700-2b734,U+2b740-2b81d,U+fa0e-fa0f,U+fa11,U+fa13-fa14,U+fa1f,U+fa21,U+fa23,U+fa24,U+fa27-fa29,U+3040-309f,U+30a0-30ff,U+3099-309e,U+ff66-ff9f,U+3007,U+31c0-31e3,U+2f00-2fd5,U+2e80-2ef3;font-family:Han Heiti;font-weight:600;src:local("YuGothic Bold"),local("Hiragino Kaku Gothic ProN W6"),local("Hiragino Kaku Gothic Pro W6"),local(YuGo-Bold),local(HiraKakuProN-W6),local(HiraKakuPro-W6)}@font-face{font-family:Han Heiti CNS;font-weight:600;src:local(".PingFang TC Semibold"),local(".PingFang-TC-Semibold"),local("Heiti TC Medium"),local("STHeitiTC-Medium"),local("Heiti TC"),local("Lantinghei TC Demibold"),local(FZLTXHB--B51-0),local("Microsoft Jhenghei Bold"),local(MicrosoftJhengHeiBold),local("Microsoft Jhenghei"),local("Microsoft YaHei Bold"),local(MicrosoftYaHei-Bold),local("Noto Sans CJK TC Bold"),local(NotoSansCJKtc-Bold),local("Noto Sans CJK TC"),local("Source Han Sans TC Bold"),local("SourceHanSansTC-Bold"),local("Source Han Sans TC"),local("Source Han Sans TW Bold"),local("SourceHanSans-TW"),local("Source Han Sans TW"),local("Source Han Sans TWHK Bold"),local("SourceHanSans-TWHK"),local("Source Han Sans TWHK"),local("Source Han Sans HK"),local("SourceHanSans-HK"),local("Source Han Sans HK")}@font-face{font-family:Han Heiti GB;font-weight:600;src:local("Hiragino Sans GB W6"),local(HiraginoSansGB-W6),local(".PingFang SC Semibold"),local(".PingFang-SC-Semibold"),local("Lantinghei SC Demibold"),local(FZLTZHK--GBK1-0),local("Heiti SC Medium"),local("STHeitiSC-Medium"),local("Heiti SC"),local("Microsoft YaHei Bold"),local(MicrosoftYaHei-Bold),local("Microsoft YaHei"),local("Noto Sans CJK SC Bold"),local(NotoSansCJKsc-Bold),local("Noto Sans CJK SC"),local("Source Han Sans SC Bold"),local("SourceHanSansSC-Bold"),local("Source Han Sans CN Bold"),local("SourceHanSansCN-Bold"),local("Source Han Sans SC"),local("Source Han Sans CN")}@font-face{font-family:Han Heiti;src:local("Hiragino Sans GB"),local("Lantinghei TC Extralight"),local("Lantinghei SC Extralight"),local(FZLTXHB--B51-0),local(FZLTZHK--GBK1-0),local(".PingFang SC Light"),local(".PingFang TC Light"),local(".PingFang-SC-Light"),local(".PingFang-TC-Light"),local(".PingFang SC"),local(".PingFang TC"),local("Heiti SC Light"),local("STHeitiSC-Light"),local("Heiti SC"),local("Heiti TC Light"),local("STHeitiTC-Light"),local("Heiti TC"),local("Microsoft Yahei"),local("Microsoft Jhenghei"),local("Noto Sans CJK KR"),local("Noto Sans CJK JP"),local("Noto Sans CJK SC"),local("Noto Sans CJK TC"),local("Source Han Sans K"),local("Source Han Sans KR"),local("Source Han Sans JP"),local("Source Han Sans CN"),local("Source Han Sans HK"),local("Source Han Sans TW"),local("Source Han Sans TWHK"),local("Droid Sans Fallback");unicode-range:U+270c}@font-face{font-family:Han Heiti;font-weight:600;src:local("Hiragino Sans GB W6"),local(HiraginoSansGB-W6),local("Lantinghei TC Demibold"),local("Lantinghei SC Demibold"),local(FZLTZHB--B51-0),local(FZLTZHK--GBK1-0),local(".PingFang-SC-Semibold"),local(".PingFang-TC-Semibold"),local("Heiti SC Medium"),local("STHeitiSC-Medium"),local("Heiti SC"),local("Heiti TC Medium"),local("STHeitiTC-Medium"),local("Heiti TC"),local("Microsoft YaHei Bold"),local("Microsoft Jhenghei Bold"),local(MicrosoftYaHei-Bold),local(MicrosoftJhengHeiBold),local("Microsoft YaHei"),local("Microsoft Jhenghei"),local("Noto Sans CJK KR Bold"),local("Noto Sans CJK JP Bold"),local("Noto Sans CJK SC Bold"),local("Noto Sans CJK TC Bold"),local(NotoSansCJKkr-Bold),local(NotoSansCJKjp-Bold),local(NotoSansCJKsc-Bold),local(NotoSansCJKtc-Bold),local("Source Han Sans K Bold"),local(SourceHanSansK-Bold),local("Source Han Sans K"),local("Source Han Sans KR Bold"),local("Source Han Sans JP Bold"),local("Source Han Sans CN Bold"),local("Source Han Sans HK Bold"),local("Source Han Sans TW Bold"),local("Source Han Sans TWHK Bold"),local("SourceHanSansKR-Bold"),local("SourceHanSansJP-Bold"),local("SourceHanSansCN-Bold"),local("SourceHanSansHK-Bold"),local("SourceHanSansTW-Bold"),local("SourceHanSansTWHK-Bold"),local("Source Han Sans KR"),local("Source Han Sans CN"),local("Source Han Sans HK"),local("Source Han Sans TW"),local("Source Han Sans TWHK");unicode-range:U+270c}@font-face{font-family:Han Songti;src:local("Songti SC Regular"),local(STSongti-SC-Regular),local("Songti SC"),local("Songti TC Regular"),local(STSongti-TC-Regular),local("Songti TC"),local(STSong),local("Lisong Pro"),local(SimSun),local(PMingLiU)}@font-face{unicode-range:U+4e00-9fff,U+3400-4db5,U+20000-2a6d6,U+2a700-2b734,U+2b740-2b81d,U+fa0e-fa0f,U+fa11,U+fa13-fa14,U+fa1f,U+fa21,U+fa23,U+fa24,U+fa27-fa29,U+3040-309f,U+30a0-30ff,U+3099-309e,U+ff66-ff9f,U+3007,U+31c0-31e3,U+2f00-2fd5,U+2e80-2ef3;font-family:Han Songti;src:local(YuMincho),local("Hiragino Mincho ProN"),local("Hiragino Mincho Pro"),local("MS Mincho")}@font-face{font-family:Han Songti CNS;src:local("Songti TC Regular"),local(STSongti-TC-Regular),local("Songti TC"),local("Lisong Pro"),local("Songti SC Regular"),local(STSongti-SC-Regular),local("Songti SC"),local(STSong),local(PMingLiU),local(SimSun)}@font-face{font-family:Han Songti GB;src:local("Songti SC Regular"),local(STSongti-SC-Regular),local("Songti SC"),local(STSong),local(SimSun),local(PMingLiU)}@font-face{font-family:Han Songti;font-weight:600;src:local("STSongti SC Bold"),local("STSongti TC Bold"),local(STSongti-SC-Bold),local(STSongti-TC-Bold),local("STSongti SC"),local("STSongti TC")}@font-face{unicode-range:U+4e00-9fff,U+3400-4db5,U+20000-2a6d6,U+2a700-2b734,U+2b740-2b81d,U+fa0e-fa0f,U+fa11,U+fa13-fa14,U+fa1f,U+fa21,U+fa23,U+fa24,U+fa27-fa29,U+3040-309f,U+30a0-30ff,U+3099-309e,U+ff66-ff9f,U+3007,U+31c0-31e3,U+2f00-2fd5,U+2e80-2ef3;font-family:Han Songti;font-weight:600;src:local("YuMincho Demibold"),local("Hiragino Mincho ProN W6"),local("Hiragino Mincho Pro W6"),local(YuMin-Demibold),local(HiraMinProN-W6),local(HiraMinPro-W6),local(YuMincho),local("Hiragino Mincho ProN"),local("Hiragino Mincho Pro")}@font-face{font-family:Han Songti CNS;font-weight:600;src:local("STSongti TC Bold"),local("STSongti SC Bold"),local(STSongti-TC-Bold),local(STSongti-SC-Bold),local("STSongti TC"),local("STSongti SC")}@font-face{font-family:Han Songti GB;font-weight:600;src:local("STSongti SC Bold"),local(STSongti-SC-Bold),local("STSongti SC")}@font-face{font-family:Han Songti;src:local("Songti SC Regular"),local(STSongti-SC-Regular),local("Songti SC"),local("Songti TC Regular"),local(STSongti-TC-Regular),local("Songti TC"),local(STSongti),local("Lisong Pro"),local("MS Mincho"),local(SimSun),local(PMingLiU);unicode-range:U+270c}@font-face{font-family:Han Songti;font-weight:600;src:local("Songti TC Bold"),local("Songti SC Bold"),local(STSongti-TC-Bold),local(STSongti-SC-Bold),local("Songti TC"),local("Songti SC");unicode-range:U+270c}@font-face{font-family:Han Songti CNS;src:local("Songti TC Regular"),local("Lisong Pro"),local("Songti TC"),local("Songti SC Regular"),local(STSong),local("Songti SC"),local("MS Mincho"),local(PMingLiU),local(SimSun);unicode-range:U+270c}@font-face{font-family:Han Songti CNS;font-weight:600;src:local("Songti TC Bold"),local("Songti SC Bold"),local(STSongti-TC-Bold),local(STSongti-SC-Bold),local("Songti TC"),local("Songti SC");unicode-range:U+270c}@font-face{font-family:Han Songti GB;src:local("Songti SC"),local(STSong),local(SimSun);unicode-range:U+270c}@font-face{font-family:Han Songti GB;font-weight:600;src:local("Songti SC Bold"),local(STSongti-SC-Bold),local("Songti SC");unicode-range:U+270c}@font-face{font-family:cursive;src:local("Kaiti TC Regular"),local(STKaiTi-TC-Regular),local("Kaiti TC"),local("Kaiti SC"),local(STKaiti),local(BiauKai),local("\6A19\6977\9AD4"),local(DFKaiShu-SB-Estd-BF),local(Kaiti),local(DFKai-SB)}@font-face{unicode-range:U+4e00-9fff,U+3400-4db5,U+20000-2a6d6,U+2a700-2b734,U+2b740-2b81d,U+fa0e-fa0f,U+fa11,U+fa13-fa14,U+fa1f,U+fa21,U+fa23,U+fa24,U+fa27-fa29,U+3040-309f,U+30a0-30ff,U+3099-309e,U+ff66-ff9f,U+3007,U+31c0-31e3,U+2f00-2fd5,U+2e80-2ef3;font-family:Han Kaiti;src:local("Kaiti TC Regular"),local(STKaiTi-TC-Regular),local("Kaiti TC"),local("Kaiti SC"),local(STKaiti),local(BiauKai),local("\6A19\6977\9AD4"),local(DFKaiShu-SB-Estd-BF),local(Kaiti),local(DFKai-SB)}@font-face{unicode-range:U+4e00-9fff,U+3400-4db5,U+20000-2a6d6,U+2a700-2b734,U+2b740-2b81d,U+fa0e-fa0f,U+fa11,U+fa13-fa14,U+fa1f,U+fa21,U+fa23,U+fa24,U+fa27-fa29,U+3040-309f,U+30a0-30ff,U+3099-309e,U+ff66-ff9f,U+3007,U+31c0-31e3,U+2f00-2fd5,U+2e80-2ef3;font-family:Han Kaiti CNS;src:local(BiauKai),local("\6A19\6977\9AD4"),local(DFKaiShu-SB-Estd-BF),local("Kaiti TC Regular"),local(STKaiTi-TC-Regular),local("Kaiti TC")}@font-face{unicode-range:U+4e00-9fff,U+3400-4db5,U+20000-2a6d6,U+2a700-2b734,U+2b740-2b81d,U+fa0e-fa0f,U+fa11,U+fa13-fa14,U+fa1f,U+fa21,U+fa23,U+fa24,U+fa27-fa29,U+3040-309f,U+30a0-30ff,U+3099-309e,U+ff66-ff9f,U+3007,U+31c0-31e3,U+2f00-2fd5,U+2e80-2ef3;font-family:Han Kaiti GB;src:local("Kaiti SC Regular"),local(STKaiTi-SC-Regular),local("Kaiti SC"),local(STKaiti),local(Kai),local(Kaiti),local(DFKai-SB)}@font-face{font-family:cursive;font-weight:600;src:local("Kaiti TC Bold"),local(STKaiTi-TC-Bold),local("Kaiti SC Bold"),local(STKaiti-SC-Bold),local("Kaiti TC"),local("Kaiti SC")}@font-face{font-family:Han Kaiti;font-weight:600;src:local("Kaiti TC Bold"),local(STKaiTi-TC-Bold "),\A       local(" Kaiti SC Bold "),\A       local(STKaiti-SC-Bold),\A       local(" Kaiti TC "),\A       local(" Kaiti SC ")\A     ;\A}\A   \A// 2\A@font-face {\A     font-family: " Han Kaiti CNS ";\A     font-weight: 600;\A     src:\A       local(" Kaiti TC Bold "),\A       local(STKaiTi-TC-Bold"),local("Kaiti TC")}@font-face{font-family:Han Kaiti GB;font-weight:600;src:local("Kaiti SC Bold"),local(STKaiti-SC-Bold)}@font-face{unicode-range:U+4e00-9fff,U+3400-4db5,U+20000-2a6d6,U+2a700-2b734,U+2b740-2b81d,U+fa0e-fa0f,U+fa11,U+fa13-fa14,U+fa1f,U+fa21,U+fa23,U+fa24,U+fa27-fa29,U+3040-309f,U+30a0-30ff,U+3099-309e,U+ff66-ff9f,U+3007,U+31c0-31e3,U+2f00-2fd5,U+2e80-2ef3;font-family:Han Fangsong;src:local(STFangsong),local(FangSong)}@font-face{unicode-range:U+4e00-9fff,U+3400-4db5,U+20000-2a6d6,U+2a700-2b734,U+2b740-2b81d,U+fa0e-fa0f,U+fa11,U+fa13-fa14,U+fa1f,U+fa21,U+fa23,U+fa24,U+fa27-fa29,U+3040-309f,U+30a0-30ff,U+3099-309e,U+ff66-ff9f,U+3007,U+31c0-31e3,U+2f00-2fd5,U+2e80-2ef3;font-family:Han Fangsong CNS;src:local(STFangsong),local(FangSong)}@font-face{unicode-range:U+4e00-9fff,U+3400-4db5,U+20000-2a6d6,U+2a700-2b734,U+2b740-2b81d,U+fa0e-fa0f,U+fa11,U+fa13-fa14,U+fa1f,U+fa21,U+fa23,U+fa24,U+fa27-fa29,U+3040-309f,U+30a0-30ff,U+3099-309e,U+ff66-ff9f,U+3007,U+31c0-31e3,U+2f00-2fd5,U+2e80-2ef3;font-family:Han Fangsong GB;src:local(STFangsong),local(FangSong)}@font-face{font-family:Biaodian Sans;src:local("Hiragino Sans GB"),local("Heiti SC"),local(STHeiti),local("MS Gothic"),local(SimSun);unicode-range:U+ff0e}@font-face{font-family:"Biaodian Serif";src:local("Hiragino Mincho ProN"),local("Hiragino Mincho Pro"),local("Songti SC"),local(STSong),local(SimSun);unicode-range:U+ff0e}@font-face{font-family:Biaodian Pro Sans;src:local("Hiragino Sans GB"),local("Heiti SC"),local(STHeiti),local("MS Gothic"),local(SimSun);unicode-range:U+ff0e}@font-face{font-family:"Biaodian Pro Serif";src:local("Hiragino Mincho ProN"),local("Hiragino Mincho Pro"),local("Songti SC"),local(STSong),local(SimSun);unicode-range:U+ff0e}@font-face{font-family:Biaodian Pro Sans CNS;src:local("Hiragino Sans GB"),local("Heiti SC"),local(STHeiti),local("MS Gothic"),local(SimSun);unicode-range:U+ff0e}@font-face{font-family:"Biaodian Pro Serif CNS";src:local("Hiragino Mincho ProN"),local("Hiragino Mincho Pro"),local("Songti SC"),local(STSong),local(SimSun);unicode-range:U+ff0e}@font-face{font-family:Biaodian Pro Sans GB;src:local("Hiragino Sans GB"),local("Heiti SC"),local(STHeiti),local("MS Gothic"),local(SimSun);unicode-range:U+ff0e}@font-face{font-family:"Biaodian Pro Serif GB";src:local("Hiragino Mincho ProN"),local("Hiragino Mincho Pro"),local("Songti SC"),local(STSong),local(SimSun);unicode-range:U+ff0e}@font-face{font-family:Biaodian Sans;src:local("Hiragino Sans GB"),local("Heiti SC"),local(STHeiti),local(SimSun);unicode-range:U+00b7}@font-face{font-family:"Biaodian Serif";src:local("Songti SC"),local(STSong),local("Heiti SC"),local(SimSun);unicode-range:U+00b7}@font-face{font-family:Biaodian Pro Sans;src:local("Hiragino Sans GB"),local("Heiti SC"),local(STHeiti),local(SimSun);unicode-range:U+00b7}@font-face{font-family:"Biaodian Pro Serif";src:local("Songti SC"),local(STSong),local("Heiti SC"),local(SimSun);unicode-range:U+00b7}@font-face{font-family:Biaodian Pro Sans CNS;src:local("Hiragino Sans GB"),local("Heiti SC"),local(STHeiti),local(SimSun);unicode-range:U+00b7}@font-face{font-family:"Biaodian Pro Serif CNS";src:local("Songti SC"),local(STSong),local("Heiti SC"),local(SimSun);unicode-range:U+00b7}@font-face{font-family:Biaodian Pro Sans GB;src:local("Hiragino Sans GB"),local("Heiti SC"),local(STHeiti),local(SimSun);unicode-range:U+00b7}@font-face{font-family:"Biaodian Pro Serif GB";src:local("Songti SC"),local(STSong),local("Heiti SC"),local(SimSun);unicode-range:U+00b7}@font-face{font-family:Biaodian Sans;src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype"),local("Hiragino Sans GB"),local("Hiragino Kaku Gothic ProN"),local("Hiragino Kaku Gothic Pro"),local("Microsoft Yahei"),local(SimSun);unicode-range:U+2014}@font-face{font-family:"Biaodian Serif";src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype"),local("Hiragino Mincho ProN"),local("Hiragino Mincho Pro"),local("Songti SC"),local(STSong),local("Microsoft Yahei"),local(SimSun);unicode-range:U+2014}@font-face{font-family:Yakumono Sans;src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype"),local("Hiragino Kaku Gothic ProN"),local("Hiragino Kaku Gothic Pro"),local("Arial Unicode MS"),local("MS Gothic");unicode-range:U+2014}@font-face{font-family:"Yakumono Serif";src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype"),local("Hiragino Mincho ProN"),local("Hiragino Mincho Pro"),local("MS Mincho"),local("Microsoft Yahei");unicode-range:U+2014}@font-face{font-family:Biaodian Pro Sans;src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype"),local("Hiragino Sans GB"),local("Hiragino Kaku Gothic ProN"),local("Hiragino Kaku Gothic Pro"),local("Microsoft Yahei"),local(SimSun);unicode-range:U+2014}@font-face{font-family:"Biaodian Pro Serif";src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype"),local("Hiragino Mincho ProN"),local("Hiragino Mincho Pro"),local("Songti SC"),local(STSong),local("Microsoft Yahei"),local(SimSun);unicode-range:U+2014}@font-face{font-family:Biaodian Pro Sans CNS;src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype"),local("Hiragino Sans GB"),local("Hiragino Kaku Gothic ProN"),local("Hiragino Kaku Gothic Pro"),local("Microsoft Yahei"),local(SimSun);unicode-range:U+2014}@font-face{font-family:"Biaodian Pro Serif CNS";src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype"),local("Hiragino Mincho ProN"),local("Hiragino Mincho Pro"),local("Songti SC"),local(STSong),local("Microsoft Yahei"),local(SimSun);unicode-range:U+2014}@font-face{font-family:Biaodian Pro Sans GB;src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype"),local("Hiragino Sans GB"),local("Hiragino Kaku Gothic ProN"),local("Hiragino Kaku Gothic Pro"),local("Microsoft Yahei"),local(SimSun);unicode-range:U+2014}@font-face{font-family:"Biaodian Pro Serif GB";src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype"),local("Hiragino Mincho ProN"),local("Hiragino Mincho Pro"),local("Songti SC"),local(STSong),local("Microsoft Yahei"),local(SimSun);unicode-range:U+2014}@font-face{font-family:Biaodian Sans;src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype"),local("Hiragino Sans GB"),local("Hiragino Kaku Gothic ProN"),local("Hiragino Kaku Gothic Pro"),local(Meiryo),local("MS Gothic"),local(SimSun),local(PMingLiU);unicode-range:U+2026}@font-face{font-family:"Biaodian Serif";src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype"),local("Hiragino Mincho ProN"),local("Hiragino Mincho Pro"),local("Songti SC"),local("MS Mincho"),local(SimSun),local(PMingLiU);unicode-range:U+2026}@font-face{font-family:Yakumono Sans;src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype"),local("Hiragino Kaku Gothic ProN"),local("Hiragino Kaku Gothic Pro"),local(Meiryo),local("MS Gothic");unicode-range:U+2026}@font-face{font-family:"Yakumono Serif";src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype"),local("Hiragino Mincho ProN"),local("Hiragino Mincho Pro"),local("MS Mincho");unicode-range:U+2026}@font-face{font-family:Biaodian Pro Sans;src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype"),local("Hiragino Sans GB"),local("Hiragino Kaku Gothic ProN"),local("Hiragino Kaku Gothic Pro"),local(SimSun),local(PMingLiU);unicode-range:U+2026}@font-face{font-family:"Biaodian Pro Serif";src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype"),local("Hiragino Mincho ProN"),local("Hiragino Mincho Pro"),local("Songti SC"),local(SimSun),local(PMingLiU);unicode-range:U+2026}@font-face{font-family:Biaodian Pro Sans CNS;src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype"),local("Hiragino Sans GB"),local("Hiragino Kaku Gothic ProN"),local("Hiragino Kaku Gothic Pro"),local(SimSun),local(PMingLiU);unicode-range:U+2026}@font-face{font-family:"Biaodian Pro Serif CNS";src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype"),local("Hiragino Mincho ProN"),local("Hiragino Mincho Pro"),local("Songti SC"),local(STSongti),local(SimSun),local(PMingLiU);unicode-range:U+2026}@font-face{font-family:Biaodian Pro Sans GB;src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype"),local("Hiragino Sans GB"),local("Hiragino Kaku Gothic ProN"),local("Hiragino Kaku Gothic Pro"),local(SimSun),local(PMingLiU);unicode-range:U+2026}@font-face{font-family:"Biaodian Pro Serif GB";src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype"),local("Hiragino Mincho ProN"),local("Hiragino Mincho Pro"),local("Songti SC"),local(STSongti),local(SimSun),local(PMingLiU);unicode-range:U+2026}@font-face{font-family:Biaodian Pro Sans GB;src:local("Hiragino Sans GB"),local("Heiti SC"),local(STHeiti),local(SimSun),local(PMingLiU);unicode-range:U+201c-201d,U+2018-2019}@font-face{font-family:Biaodian Pro Sans GB;font-weight:700;src:local("Hiragino Sans GB"),local("Heiti SC"),local(STHeiti),local(SimSun),local(PMingLiU);unicode-range:U+201c-201d,U+2018-2019}@font-face{font-family:"Biaodian Pro Serif GB";src:local("Lisong Pro"),local("Heiti SC"),local(STHeiti),local(SimSun),local(PMingLiU);unicode-range:U+201c-201d,U+2018-2019}@font-face{font-family:"Biaodian Pro Serif GB";font-weight:700;src:local("Lisong Pro"),local("Heiti SC"),local(STHeiti),local(SimSun),local(PMingLiU);unicode-range:U+201c-201d,U+2018-2019}@font-face{font-family:Biaodian Sans;src:local(Georgia),local("Times New Roman"),local(Arial),local("Droid Sans Fallback");unicode-range:U+25cf}@font-face{font-family:"Biaodian Serif";src:local(Georgia),local("Times New Roman"),local(Arial),local("Droid Sans Fallback");unicode-range:U+25cf}@font-face{font-family:Biaodian Pro Sans;src:local(Georgia),local("Times New Roman"),local(Arial),local("Droid Sans Fallback");unicode-range:U+25cf}@font-face{font-family:"Biaodian Pro Serif";src:local(Georgia),local("Times New Roman"),local(Arial),local("Droid Sans Fallback");unicode-range:U+25cf}@font-face{font-family:Biaodian Pro Sans CNS;src:local(Georgia),local("Times New Roman"),local(Arial),local("Droid Sans Fallback");unicode-range:U+25cf}@font-face{font-family:"Biaodian Pro Serif CNS";src:local(Georgia),local("Times New Roman"),local(Arial),local("Droid Sans Fallback");unicode-range:U+25cf}@font-face{font-family:Biaodian Pro Sans GB;src:local(Georgia),local("Times New Roman"),local(Arial),local("Droid Sans Fallback");unicode-range:U+25cf}@font-face{font-family:"Biaodian Pro Serif GB";src:local(Georgia),local("Times New Roman"),local(Arial),local("Droid Sans Fallback");unicode-range:U+25cf}@font-face{font-family:Biaodian Pro Sans;src:local("Hiragino Kaku Gothic ProN"),local("Hiragino Kaku Gothic Pro"),local("MS Gothic");unicode-range:U+3002,U+ff0c,U+3001,U+ff1b,U+ff1a,U+ff1f,U+ff01,U+ff0d,U+ff0f,U+ff3c}@font-face{font-family:"Biaodian Pro Serif";src:local("Hiragino Mincho ProN"),local("Hiragino Mincho Pro"),local("MS Mincho");unicode-range:U+3002,U+ff0c,U+3001,U+ff1b,U+ff1a,U+ff1f,U+ff01,U+ff0d,U+ff0f,U+ff3c}@font-face{font-family:Biaodian Pro Sans CNS;src:local("Heiti TC"),local("Lihei Pro"),local("Microsoft Jhenghei"),local(PMingLiU);unicode-range:U+3002,U+ff0c,U+3001}@font-face{font-family:Biaodian Pro Sans CNS;src:local("Hiragino Kaku Gothic ProN"),local("Hiragino Kaku Gothic Pro"),local("Heiti TC"),local("Lihei Pro"),local("Microsoft Jhenghei"),local(PMingLiU),local("MS Gothic");unicode-range:U+ff1b,U+ff1a,U+ff1f,U+ff01}@font-face{font-family:Biaodian Pro Sans CNS;src:local("Hiragino Mincho ProN"),local("Hiragino Mincho Pro"),local("MS Mincho");unicode-range:U+ff0d,U+ff0f,U+ff3c}@font-face{font-family:"Biaodian Pro Serif CNS";src:local(STSongti-TC-Regular),local("Lisong Pro"),local("Heiti TC"),local(PMingLiU);unicode-range:U+3002,U+ff0c,U+3001}@font-face{font-family:"Biaodian Pro Serif CNS";src:local("Hiragino Mincho ProN"),local("Hiragino Mincho Pro"),local(PMingLiU),local("MS Mincho");unicode-range:U+ff1b,U+ff1a,U+ff1f,U+ff01,U+ff0d,U+ff0f,U+ff3c}@font-face{font-family:Biaodian Pro Sans GB;src:local("Hiragino Sans GB"),local("Heiti SC"),local(STHeiti),local("Hiragino Kaku Gothic ProN"),local("Hiragino Kaku Gothic Pro"),local(SimSun),local("MS Gothic");unicode-range:U+3002,U+ff0c,U+3001,U+ff1b,U+ff1a,U+ff1f,U+ff01,U+ff0d,U+ff0f,U+ff3c}@font-face{font-family:"Biaodian Pro Serif GB";src:local("Songti SC"),local(STSongti),local("Hiragino Mincho ProN"),local("Hiragino Mincho Pro"),local("Hiragino Sans GB"),local("Heiti SC"),local(STHeiti),local(SimSun),local("MS Mincho");unicode-range:U+3002,U+ff0c,U+3001,U+ff1b,U+ff1a,U+ff1f,U+ff01}@font-face{font-family:"Biaodian Pro Serif GB";src:local("Hiragino Mincho ProN"),local("Hiragino Mincho Pro"),local(PMingLiU),local("MS Mincho");unicode-range:U+ff0d,U+ff0f,U+ff3c}@font-face{font-family:Biaodian Pro Sans;src:local("Hiragino Kaku Gothic ProN"),local("Hiragino Kaku Gothic Pro"),local("Yu Gothic"),local(YuGothic),local(SimSun),local(PMingLiU);unicode-range:U+300c-300f,U+300a-300b,U+3008-3009,U+ff08-ff09,U+3014-3015}@font-face{font-family:"Biaodian Pro Serif";src:local("Hiragino Mincho ProN"),local("Hiragino Mincho Pro"),local("Yu Mincho"),local(YuMincho),local(SimSun),local(PMingLiU);unicode-range:U+300c-300f,U+300a-300b,U+3008-3009,U+ff08-ff09,U+3014-3015}@font-face{font-family:Biaodian Pro Sans CNS;src:local("Hiragino Kaku Gothic ProN"),local("Hiragino Kaku Gothic Pro"),local("Yu Gothic"),local(YuGothic),local(SimSun),local(PMingLiU);unicode-range:U+300c-300f,U+300a-300b,U+3008-3009,U+ff08-ff09,U+3014-3015}@font-face{font-family:"Biaodian Pro Serif CNS";src:local("Hiragino Mincho ProN"),local("Hiragino Mincho Pro"),local("Yu Mincho"),local(YuMincho),local(SimSun),local(PMingLiU);unicode-range:U+300c-300f,U+300a-300b,U+3008-3009,U+ff08-ff09,U+3014-3015}@font-face{font-family:Biaodian Pro Sans GB;src:local("Hiragino Kaku Gothic ProN"),local("Hiragino Kaku Gothic Pro"),local("Yu Gothic"),local(YuGothic),local(SimSun),local(PMingLiU);unicode-range:U+300c-300f,U+300a-300b,U+3008-3009,U+ff08-ff09,U+3014-3015}@font-face{font-family:"Biaodian Pro Serif GB";src:local("Hiragino Mincho ProN"),local("Hiragino Mincho Pro"),local("Yu Mincho"),local(YuMincho),local(SimSun),local(PMingLiU);unicode-range:U+300c-300f,U+300a-300b,U+3008-3009,U+ff08-ff09,U+3014-3015}@font-face{font-family:Biaodian Basic;src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype");unicode-range:U+2014,U+2026,U+00b7}@font-face{font-family:Biaodian Basic;font-weight:700;src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype");unicode-range:U+2014,U+2026,U+00b7}@font-face{font-family:Biaodian Sans;font-weight:700;src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype");unicode-range:U+2014,U+2026,U+00b7}@font-face{font-family:Biaodian Pro Sans;font-weight:700;src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype");unicode-range:U+2014,U+2026,U+00b7}@font-face{font-family:Biaodian Pro Sans CNS;font-weight:700;src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype");unicode-range:U+2014,U+2026,U+00b7}@font-face{font-family:Biaodian Pro Sans GB;font-weight:700;src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype");unicode-range:U+2014,U+2026,U+00b7}@font-face{font-family:"Biaodian Pro Serif";font-weight:700;src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype");unicode-range:U+2014,U+2026,U+00b7}@font-face{font-family:"Biaodian Pro Serif CNS";font-weight:700;src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype");unicode-range:U+2014,U+2026,U+00b7}@font-face{font-family:"Biaodian Pro Serif GB";font-weight:700;src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype");unicode-range:U+2014,U+2026,U+00b7}@font-face{font-family:"Latin Italic Serif";src:local("Georgia Italic"),local("Times New Roman Italic"),local(Georgia-Italic),local(TimesNewRomanPS-ItalicMT),local(Times-Italic)}@font-face{font-family:"Latin Italic Serif";font-weight:700;src:local("Georgia Bold Italic"),local("Times New Roman Bold Italic"),local(Georgia-BoldItalic),local(TimesNewRomanPS-BoldItalicMT),local(Times-Italic)}@font-face{font-family:Latin Italic Sans;src:local("Helvetica Neue Italic"),local("Helvetica Oblique"),local("Arial Italic"),local(HelveticaNeue-Italic),local(Helvetica-LightOblique),local(Arial-ItalicMT)}@font-face{font-family:Latin Italic Sans;font-weight:700;src:local("Helvetica Neue Bold Italic"),local("Helvetica Bold Oblique"),local("Arial Bold Italic"),local(HelveticaNeue-BoldItalic),local(Helvetica-BoldOblique),local(Arial-BoldItalicMT)}@font-face{unicode-range:U+0030-0039;font-family:Numeral TF Sans;src:local(Skia),local("Neutraface 2 Text"),local(Candara),local(Corbel)}@font-face{unicode-range:U+0030-0039;font-family:"Numeral TF Serif";src:local(Georgia),local("Hoefler Text"),local("Big Caslon")}@font-face{unicode-range:U+0030-0039;font-family:"Numeral TF Italic Serif";src:local("Georgia Italic"),local("Hoefler Text Italic"),local(Georgia-Italic),local(HoeflerText-Italic)}@font-face{unicode-range:U+0030-0039;font-family:Numeral LF Sans;src:local("Helvetica Neue"),local(Helvetica),local(Arial)}@font-face{unicode-range:U+0030-0039;font-family:Numeral LF Italic Sans;src:local("Helvetica Neue Italic"),local("Helvetica Oblique"),local("Arial Italic"),local(HelveticaNeue-Italic),local(Helvetica-LightOblique),local(Arial-ItalicMT)}@font-face{unicode-range:U+0030-0039;font-family:Numeral LF Italic Sans;font-weight:700;src:local("Helvetica Neue Bold Italic"),local("Helvetica Bold Oblique"),local("Arial Bold Italic"),local(HelveticaNeue-BoldItalic),local(Helvetica-BoldOblique),local(Arial-BoldItalicMT)}@font-face{unicode-range:U+0030-0039;font-family:"Numeral LF Serif";src:local(Palatino),local("Palatino Linotype"),local("Times New Roman")}@font-face{unicode-range:U+0030-0039;font-family:"Numeral LF Italic Serif";src:local("Palatino Italic"),local("Palatino Italic Linotype"),local("Times New Roman Italic"),local(Palatino-Italic),local(Palatino-Italic-Linotype),local(TimesNewRomanPS-ItalicMT)}@font-face{unicode-range:U+0030-0039;font-family:"Numeral LF Italic Serif";font-weight:700;src:local("Palatino Bold Italic"),local("Palatino Bold Italic Linotype"),local("Times New Roman Bold Italic"),local(Palatino-BoldItalic),local(Palatino-BoldItalic-Linotype),local(TimesNewRomanPS-BoldItalicMT)}@font-face{font-family:Numeral TF Sans;src:local(lying-to-firefox);unicode-range:U+270c}@font-face{font-family:"Numeral TF Serif";src:local(lying-to-firefox);unicode-range:U+270c}@font-face{font-family:"Numeral TF Italic Serif";src:local(lying-to-firefox);unicode-range:U+270c}@font-face{font-family:Numeral LF Sans;src:local(lying-to-firefox);unicode-range:U+270c}@font-face{font-family:Numeral LF Italic Sans;src:local(lying-to-firefox);unicode-range:U+270c}@font-face{font-family:Numeral LF Italic Sans;font-weight:700;src:local(lying-to-firefox);unicode-range:U+270c}@font-face{font-family:"Numeral LF Serif";src:local(lying-to-firefox);unicode-range:U+270c}@font-face{font-family:"Numeral LF Italic Serif";src:local(lying-to-firefox);unicode-range:U+270c}@font-face{font-family:"Numeral LF Italic Serif";font-weight:700;src:local(lying-to-firefox);unicode-range:U+270c}@font-face{src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype");unicode-range:U+3105-312d,U+31a0-31ba,U+02d9,U+02ca,U+02c5,U+02c7,U+02cb,U+02ea-02eb,U+030d,U+0358,U+f31b4-f31b7,U+f0061,U+f0065,U+f0069,U+f006f,U+f0075;font-family:Zhuyin Kaiti}@font-face{unicode-range:U+3105-312d,U+31a0-31ba,U+02d9,U+02ca,U+02c5,U+02c7,U+02cb,U+02ea-02eb,U+030d,U+0358,U+f31b4-f31b7,U+f0061,U+f0065,U+f0069,U+f006f,U+f0075;font-family:Zhuyin Heiti;src:local("Hiragino Sans GB"),local("Heiti TC"),local("Microsoft Jhenghei"),url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype")}@font-face{font-family:Zhuyin Heiti;src:local("Heiti TC"),local("Microsoft Jhenghei"),url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype");unicode-range:U+3127}@font-face{src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype");font-family:Zhuyin Heiti;unicode-range:U+02d9,U+02ca,U+02c5,U+02c7,U+02cb,U+02ea-02eb,U+31b4,U+31b5,U+31b6,U+31b7,U+030d,U+0358,U+f31b4-f31b7,U+f0061,U+f0065,U+f0069,U+f006f,U+f0075}@font-face{src:url(/static/han-e841c6b547bc06a06f60f4de52bf906e.woff) format("woff"),url(/static/han-202673272279abf200bd0e6ef6a96935.otf) format("opentype");font-family:Romanization Sans;unicode-range:U+030d,U+0358,U+f31b4-f31b7,U+f0061,U+f0065,U+f0069,U+f006f,U+f0075}article strong:lang(ja-Latn),article strong :lang(ja-Latn),article strong:lang(zh-Latn),article strong :lang(zh-Latn),article strong:not(:lang(zh)):not(:lang(ja)),article strong :not(:lang(zh)):not(:lang(ja)),html:lang(ja-Latn),html :lang(ja-Latn),html:lang(zh-Latn),html :lang(zh-Latn),html:not(:lang(zh)):not(:lang(ja)),html :not(:lang(zh)):not(:lang(ja)){font-family:PT Mono,monospace,Han Heiti,sans-serif}[lang*=Hant],[lang=zh-HK],[lang=zh-TW],[lang^=zh],article strong:lang(zh),article strong:lang(zh-Hant),html:lang(zh),html:lang(zh-Hant){font-family:Biaodian Pro Sans CNS,PT Mono,monospace,Zhuyin Heiti,Han Heiti,sans-serif}.no-unicoderange [lang*=Hant],.no-unicoderange [lang=zh-HK],.no-unicoderange [lang=zh-TW],.no-unicoderange [lang^=zh],.no-unicoderange article strong:lang(zh),.no-unicoderange article strong:lang(zh-Hant),html.no-unicoderange:lang(zh),html.no-unicoderange:lang(zh-Hant){font-family:PT Mono,monospace,Han Heiti,sans-serif}[lang*=Hans],[lang=zh-CN],article strong:lang(zh-CN),article strong:lang(zh-Hans),html:lang(zh-CN),html:lang(zh-Hans){font-family:Biaodian Pro Sans GB,PT Mono,monospace,Han Heiti GB,sans-serif}.no-unicoderange [lang*=Hans],.no-unicoderange [lang=zh-CN],.no-unicoderange article strong:lang(zh-CN),.no-unicoderange article strong:lang(zh-Hans),html.no-unicoderange:lang(zh-CN),html.no-unicoderange:lang(zh-Hans){font-family:PT Mono,monospace,Han Heiti GB,sans-serif}[lang^=ja],article strong:lang(ja),html:lang(ja){font-family:Yakumono Sans,PT Mono,monospace,sans-serif}.no-unicoderange [lang^=ja],.no-unicoderange article strong:lang(ja),html.no-unicoderange:lang(ja){font-family:PT Mono,monospace,sans-serif}article blockquote i:lang(ja-Latn),article blockquote i :lang(ja-Latn),article blockquote i:lang(zh-Latn),article blockquote i :lang(zh-Latn),article blockquote i:not(:lang(zh)):not(:lang(ja)),article blockquote i :not(:lang(zh)):not(:lang(ja)),article blockquote var:lang(ja-Latn),article blockquote var :lang(ja-Latn),article blockquote var:lang(zh-Latn),article blockquote var :lang(zh-Latn),article blockquote var:not(:lang(zh)):not(:lang(ja)),article blockquote var :not(:lang(zh)):not(:lang(ja)){font-family:Latin Italic Sans,PT Mono,monospace,Han Heiti,sans-serif}article blockquote i:lang(zh),article blockquote i:lang(zh-Hant),article blockquote var:lang(zh),article blockquote var:lang(zh-Hant){font-family:Biaodian Pro Sans CNS,Latin Italic Sans,PT Mono,monospace,Zhuyin Heiti,Han Heiti,sans-serif}.no-unicoderange article blockquote i:lang(zh),.no-unicoderange article blockquote i:lang(zh-Hant),.no-unicoderange article blockquote var:lang(zh),.no-unicoderange article blockquote var:lang(zh-Hant){font-family:Latin Italic Sans,PT Mono,monospace,Han Heiti,sans-serif}article blockquote i:lang(zh-CN),article blockquote i:lang(zh-Hans),article blockquote var:lang(zh-CN),article blockquote var:lang(zh-Hans){font-family:Biaodian Pro Sans GB,Latin Italic Sans,PT Mono,monospace,Han Heiti GB,sans-serif}.no-unicoderange article blockquote i:lang(zh-CN),.no-unicoderange article blockquote i:lang(zh-Hans),.no-unicoderange article blockquote var:lang(zh-CN),.no-unicoderange article blockquote var:lang(zh-Hans){font-family:Latin Italic Sans,PT Mono,monospace,Han Heiti GB,sans-serif}article blockquote i:lang(ja),article blockquote var:lang(ja){font-family:Yakumono Sans,Latin Italic Sans,PT Mono,monospace,sans-serif}.no-unicoderange article blockquote i:lang(ja),.no-unicoderange article blockquote var:lang(ja){font-family:Latin Italic Sans,PT Mono,monospace,sans-serif}article figure blockquote:lang(ja-Latn),article figure blockquote :lang(ja-Latn),article figure blockquote:lang(zh-Latn),article figure blockquote :lang(zh-Latn),article figure blockquote:not(:lang(zh)):not(:lang(ja)),article figure blockquote :not(:lang(zh)):not(:lang(ja)),figure blockquote:lang(ja-Latn),figure blockquote :lang(ja-Latn),figure blockquote:lang(zh-Latn),figure blockquote :lang(zh-Latn),figure blockquote:not(:lang(zh)):not(:lang(ja)),figure blockquote :not(:lang(zh)):not(:lang(ja)){font-family:CELESTE,Georgia,Times New Roman,Han Songti,cursive,serif}article figure blockquote:lang(zh),article figure blockquote:lang(zh-Hant),figure blockquote:lang(zh),figure blockquote:lang(zh-Hant){font-family:"Biaodian Pro Serif CNS","Numeral LF Serif",CELESTE,Georgia,Times New Roman,Zhuyin Kaiti,Han Songti,serif}.no-unicoderange article figure blockquote:lang(zh),.no-unicoderange article figure blockquote:lang(zh-Hant),.no-unicoderange figure blockquote:lang(zh),.no-unicoderange figure blockquote:lang(zh-Hant){font-family:"Numeral LF Serif",CELESTE,Georgia,Times New Roman,Han Songti,serif}article figure blockquote:lang(zh-CN),article figure blockquote:lang(zh-Hans),figure blockquote:lang(zh-CN),figure blockquote:lang(zh-Hans){font-family:"Biaodian Pro Serif GB","Numeral LF Serif",CELESTE,Georgia,Times New Roman,Han Songti GB,serif}.no-unicoderange article figure blockquote:lang(zh-CN),.no-unicoderange article figure blockquote:lang(zh-Hans),.no-unicoderange figure blockquote:lang(zh-CN),.no-unicoderange figure blockquote:lang(zh-Hans){font-family:"Numeral LF Serif",CELESTE,Georgia,Times New Roman,Han Songti GB,serif}article figure blockquote:lang(ja),figure blockquote:lang(ja){font-family:"Yakumono Serif","Numeral LF Serif",CELESTE,Georgia,Times New Roman,serif}.no-unicoderange article figure blockquote:lang(ja),.no-unicoderange figure blockquote:lang(ja){font-family:"Numeral LF Serif",CELESTE,Georgia,Times New Roman,serif}article blockquote:lang(ja-Latn),article blockquote :lang(ja-Latn),article blockquote:lang(zh-Latn),article blockquote :lang(zh-Latn),article blockquote:not(:lang(zh)):not(:lang(ja)),article blockquote :not(:lang(zh)):not(:lang(ja)){font-family:CELESTE,Georgia,Times New Roman,Han Kaiti,cursive,serif}article blockquote:lang(zh),article blockquote:lang(zh-Hant){font-family:"Biaodian Pro Serif CNS","Numeral LF Serif",CELESTE,Georgia,Times New Roman,Zhuyin Kaiti,Han Kaiti,cursive,serif}.no-unicoderange article blockquote:lang(zh),.no-unicoderange article blockquote:lang(zh-Hant){font-family:"Numeral LF Serif",CELESTE,Georgia,Times New Roman,Han Kaiti,cursive,serif}article blockquote:lang(zh-CN),article blockquote:lang(zh-Hans){font-family:"Biaodian Pro Serif GB","Numeral LF Serif",CELESTE,Georgia,Times New Roman,Han Kaiti GB,cursive,serif}.no-unicoderange article blockquote:lang(zh-CN),.no-unicoderange article blockquote:lang(zh-Hans){font-family:"Numeral LF Serif",CELESTE,Georgia,Times New Roman,Han Kaiti GB,cursive,serif}article blockquote:lang(ja){font-family:"Yakumono Serif","Numeral LF Serif",CELESTE,Georgia,Times New Roman,cursive,serif}.no-unicoderange article blockquote:lang(ja){font-family:"Numeral LF Serif",CELESTE,Georgia,Times New Roman,cursive,serif}i:lang(ja-Latn),i :lang(ja-Latn),i:lang(zh-Latn),i :lang(zh-Latn),i:not(:lang(zh)):not(:lang(ja)),i :not(:lang(zh)):not(:lang(ja)),var:lang(ja-Latn),var :lang(ja-Latn),var:lang(zh-Latn),var :lang(zh-Latn),var:not(:lang(zh)):not(:lang(ja)),var :not(:lang(zh)):not(:lang(ja)){font-family:"Latin Italic Serif",CELESTE,Georgia,Times New Roman,Han Kaiti,cursive,serif}i:lang(zh),i:lang(zh-Hant),var:lang(zh),var:lang(zh-Hant){font-family:"Biaodian Pro Serif CNS","Numeral LF Italic Serif","Latin Italic Serif",CELESTE,Georgia,Times New Roman,Zhuyin Kaiti,Han Kaiti,cursive,serif}.no-unicoderange i:lang(zh),.no-unicoderange i:lang(zh-Hant),.no-unicoderange var:lang(zh),.no-unicoderange var:lang(zh-Hant){font-family:"Numeral LF Italic Serif","Latin Italic Serif",CELESTE,Georgia,Times New Roman,Han Kaiti,cursive,serif}i:lang(zh-CN),i:lang(zh-Hans),var:lang(zh-CN),var:lang(zh-Hans){font-family:"Biaodian Pro Serif GB","Numeral LF Italic Serif","Latin Italic Serif",CELESTE,Georgia,Times New Roman,Han Kaiti GB,cursive,serif}.no-unicoderange i:lang(zh-CN),.no-unicoderange i:lang(zh-Hans),.no-unicoderange var:lang(zh-CN),.no-unicoderange var:lang(zh-Hans){font-family:"Numeral LF Italic Serif","Latin Italic Serif",CELESTE,Georgia,Times New Roman,Han Kaiti GB,cursive,serif}i:lang(ja),var:lang(ja){font-family:"Yakumono Serif","Numeral LF Italic Serif","Latin Italic Serif",CELESTE,Georgia,Times New Roman,cursive,serif}.no-unicoderange i:lang(ja),.no-unicoderange var:lang(ja){font-family:"Numeral LF Italic Serif","Latin Italic Serif",CELESTE,Georgia,Times New Roman,cursive,serif}code:lang(ja-Latn),code :lang(ja-Latn),code:lang(zh-Latn),code :lang(zh-Latn),code:not(:lang(zh)):not(:lang(ja)),code :not(:lang(zh)):not(:lang(ja)),kbd:lang(ja-Latn),kbd :lang(ja-Latn),kbd:lang(zh-Latn),kbd :lang(zh-Latn),kbd:not(:lang(zh)):not(:lang(ja)),kbd :not(:lang(zh)):not(:lang(ja)),pre:lang(ja-Latn),pre :lang(ja-Latn),pre:lang(zh-Latn),pre :lang(zh-Latn),pre:not(:lang(zh)):not(:lang(ja)),pre :not(:lang(zh)):not(:lang(ja)),samp:lang(ja-Latn),samp :lang(ja-Latn),samp:lang(zh-Latn),samp :lang(zh-Latn),samp:not(:lang(zh)):not(:lang(ja)),samp :not(:lang(zh)):not(:lang(ja)){font-family:Menlo,Consolas,Courier,Han Heiti,monospace,monospace,sans-serif}code:lang(zh),code:lang(zh-Hant),kbd:lang(zh),kbd:lang(zh-Hant),pre:lang(zh),pre:lang(zh-Hant),samp:lang(zh),samp:lang(zh-Hant){font-family:Biaodian Pro Sans CNS,Menlo,Consolas,Courier,Zhuyin Heiti,Han Heiti,monospace,monospace,sans-serif}.no-unicoderange code:lang(zh),.no-unicoderange code:lang(zh-Hant),.no-unicoderange kbd:lang(zh),.no-unicoderange kbd:lang(zh-Hant),.no-unicoderange pre:lang(zh),.no-unicoderange pre:lang(zh-Hant),.no-unicoderange samp:lang(zh),.no-unicoderange samp:lang(zh-Hant){font-family:Menlo,Consolas,Courier,Han Heiti,monospace,monospace,sans-serif}code:lang(zh-CN),code:lang(zh-Hans),kbd:lang(zh-CN),kbd:lang(zh-Hans),pre:lang(zh-CN),pre:lang(zh-Hans),samp:lang(zh-CN),samp:lang(zh-Hans){font-family:Biaodian Pro Sans GB,Menlo,Consolas,Courier,Han Heiti GB,monospace,monospace,sans-serif}.no-unicoderange code:lang(zh-CN),.no-unicoderange code:lang(zh-Hans),.no-unicoderange kbd:lang(zh-CN),.no-unicoderange kbd:lang(zh-Hans),.no-unicoderange pre:lang(zh-CN),.no-unicoderange pre:lang(zh-Hans),.no-unicoderange samp:lang(zh-CN),.no-unicoderange samp:lang(zh-Hans){font-family:Menlo,Consolas,Courier,Han Heiti GB,monospace,monospace,sans-serif}code:lang(ja),kbd:lang(ja),pre:lang(ja),samp:lang(ja){font-family:Yakumono Sans,Menlo,Consolas,Courier,monospace,monospace,sans-serif}.no-unicoderange code:lang(ja),.no-unicoderange kbd:lang(ja),.no-unicoderange pre:lang(ja),.no-unicoderange samp:lang(ja){font-family:Menlo,Consolas,Courier,monospace,monospace,sans-serif}.no-unicoderange h-char.bd-liga,.no-unicoderange h-char[unicode=b7],h-ruby.romanization rt,h-ruby [annotation] rt,h-ruby h-diao,h-ruby h-zhuyin,html,ruby.romanization rt,ruby [annotation] rt,ruby h-diao,ruby h-zhuyin{-ms-font-feature-settings:"liga";font-feature-settings:"liga"}[lang*=Hans],[lang*=Hant],[lang=zh-CN],[lang=zh-HK],[lang=zh-TW],[lang^=zh],article blockquote i,article blockquote var,article strong,code,html,kbd,pre,samp{-ms-font-feature-settings:"liga","locl" 0;font-feature-settings:"liga","locl" 0}.no-unicoderange h-char.bd-cop:lang(zh-Hant),.no-unicoderange h-char.bd-cop:lang(zh-HK),.no-unicoderange h-char.bd-cop:lang(zh-TW){font-family:-apple-system,Han Heiti CNS}.no-unicoderange h-char.bd-liga,.no-unicoderange h-char[unicode=b7]{font-family:Biaodian Basic,Han Heiti}.no-unicoderange h-char[unicode="201c"]:lang(zh-CN),.no-unicoderange h-char[unicode="201c"]:lang(zh-Hans),.no-unicoderange h-char[unicode="201d"]:lang(zh-CN),.no-unicoderange h-char[unicode="201d"]:lang(zh-Hans),.no-unicoderange h-char[unicode="2018"]:lang(zh-CN),.no-unicoderange h-char[unicode="2018"]:lang(zh-Hans),.no-unicoderange h-char[unicode="2019"]:lang(zh-CN),.no-unicoderange h-char[unicode="2019"]:lang(zh-Hans){font-family:Han Heiti GB}i,var{font-style:inherit}.no-unicoderange h-ruby h-diao,.no-unicoderange h-ruby h-zhuyin,.no-unicoderange ruby h-diao,.no-unicoderange ruby h-zhuyin,h-ruby h-diao,ruby h-diao{font-family:Zhuyin Kaiti,cursive,serif}h-ruby.romanization rt,h-ruby [annotation] rt,ruby.romanization rt,ruby [annotation] rt{font-family:Romanization Sans,PT Mono,monospace,Han Heiti,sans-serif}.no-kaiti i,.no-kaiti var{padding-bottom:.05em;border-bottom:3px double #d3d3d3}article{line-height:1.7;-ms-hyphens:auto;-webkit-hyphens:auto;hyphens:auto}article li,article p{text-align:justify;text-justify:inter-ideograph}article h1+blockquote,article h1+h2,article h1+h3,article h1+h4,article h1+h5,article h1+h6,article h1+ol,article h1+p,article h1+section>blockquote:first-child,article h1+section>h2:first-child,article h1+section>h3:first-child,article h1+section>h4:first-child,article h1+section>h5:first-child,article h1+section>h6:first-child,article h1+section>ol:first-child,article h1+section>p:first-child,article h1+section>ul:first-child,article h1+ul,article h2+blockquote,article h2+h2,article h2+h3,article h2+h4,article h2+h5,article h2+h6,article h2+ol,article h2+p,article h2+section>blockquote:first-child,article h2+section>h2:first-child,article h2+section>h3:first-child,article h2+section>h4:first-child,article h2+section>h5:first-child,article h2+section>h6:first-child,article h2+section>ol:first-child,article h2+section>p:first-child,article h2+section>ul:first-child,article h2+ul,article h3+blockquote,article h3+h3,article h3+h4,article h3+h5,article h3+h6,article h3+ol,article h3+p,article h3+section>blockquote:first-child,article h3+section>h3:first-child,article h3+section>h4:first-child,article h3+section>h5:first-child,article h3+section>h6:first-child,article h3+section>ol:first-child,article h3+section>p:first-child,article h3+section>ul:first-child,article h3+ul,article h4+blockquote,article h4+h4,article h4+h5,article h4+h6,article h4+ol,article h4+p,article h4+section>blockquote:first-child,article h4+section>h4:first-child,article h4+section>h5:first-child,article h4+section>h6:first-child,article h4+section>ol:first-child,article h4+section>p:first-child,article h4+section>ul:first-child,article h4+ul,article h5+blockquote,article h5+h5,article h5+h6,article h5+ol,article h5+p,article h5+section>blockquote:first-child,article h5+section>h5:first-child,article h5+section>h6:first-child,article h5+section>ol:first-child,article h5+section>p:first-child,article h5+section>ul:first-child,article h5+ul,article h6+blockquote,article h6+h6,article h6+ol,article h6+p,article h6+section>blockquote:first-child,article h6+section>h6:first-child,article h6+section>ol:first-child,article h6+section>p:first-child,article h6+section>ul:first-child,article h6+ul{margin-top:-1em}ol,ul{padding-left:1rem}blockquote,figure{margin-left:1rem;margin-right:1rem}.poem-like p,p.poem-like{margin-left:1rem}@media only screen and (max-width:480px){.poem-like p,p.poem-like{margin-left:1em}}article blockquote{margin-right:0}@media only screen and (max-width:480px){article blockquote{margin-left:1em}}figure blockquote{margin:0}blockquote blockquote{margin-left:.5rem;margin-right:.5rem}article blockquote blockquote{margin-right:0}@media only screen and (max-width:480px){blockquote,figure{margin-left:1em;margin-right:1em}}h-hws,h-hws[hidden]{display:inline;visibility:hidden;font:.89em Arial}code h-hws,code h-hws[hidden],h-hws.quote-inner,h-hws.quote-outer:lang(zh-CN),h-hws.quote-outer:lang(zh-Hans),h-hws[hidden].quote-inner,h-hws[hidden].quote-outer:lang(zh-CN),h-hws[hidden].quote-outer:lang(zh-Hans),kbd h-hws,kbd h-hws[hidden],pre h-hws,pre h-hws[hidden],samp h-hws,samp h-hws[hidden]{display:none}@font-face{src:url(data:font/woff;base64,d09GRk9UVE8AAAWsAAsAAAAACFwAAQABAAAAAAAAAAAAAAAAAAAAAAAAAABDRkYgAAABCAAAAUYAAAFyhzPUW0ZGVE0AAAJQAAAAHAAAABxxEJuUR0RFRgAAAmwAAAAcAAAAHgAnAA9PUy8yAAACiAAAAEgAAABgZQBqMWNtYXAAAALQAAAAQgAAAVIAIgXvaGVhZAAAAxQAAAAtAAAANgO/HHtoaGVhAAADRAAAAB4AAAAkBfYDVWhtdHgAAANkAAAAIAAAACQPzwAAbWF4cAAAA4QAAAAGAAAABgAJUABuYW1lAAADjAAAAgsAAAOT26EqFXBvc3QAAAWYAAAAEwAAACD/nQAyeJxVj7FKw1AUhs9pG2pjvNZiRCSUoB2cah2UDlLQLoIUQpWiUtQYk5rBpKStQ1/A6NWlfQ0354CDb+EDWMH93jYVTBGUnuHnfD+Hw/8jJBKAiGRfd8qu55lG23YdwBgg7PI08FXkazGei/PlREmKZ0VI3dY2KP1bpCSl3B9qggIf8wpAWgG+oEBGwYsMiJM3M0AgDSuwDkXYgSO4hGbHsQvRlKv5QmGzXG01dcPMW55uWHaj45m/3LamyG1Z51vbxT29ZV6prqNGgfWu67hqxXaMazdC9b/ANAEA3qEf9bzHB6T4iE+QQjyoaIe145PTOvdpwL8CjDQXxLm/NNTG/reWfB9mZTagYSnsC6zOLJmOe2GJ9YWbM5lFZjigAlPZqzy5oLwnEEpGz2TUJeyTvBASIX9bpDKVxEAMJCmYDaS5H17WgIkAAAAAAAEAAAAA0S6ZbgAAAADOiyhTAAAAANFW2dJ4nGNgZGBg4AFiMSBmYmAEQg4gZgHzGAAD9gA3eJxjYGb+z6jDwMrAwTSTKY2BgcEHQjOmMRgxPATygVJwoMDEBZSBckK9w/2AFC+DArPxf2OGsywMDGcZENJA1UDICAAXvgn4eJxjYGBgZoBgGQZGBhDwAfIYwXwWBgMgzQGETGAZXgaF//+RWIz/v/5/DNUFBoxsDMhcBqg+FMCMKTSsAAAGLQkRAAB4nGNgZGBgAOItc7RU4/ltvjJwszCAwMWwnERkmvEL0x4gxcHABOIBAAKDCPUAAAB4nGNgZGBgNv5vzHCWRYIBCBi/MDAyoAJOAFUmA1IAAHicY/zCAAYsEgwMzM8YGBhDgRwNBgYmAwgGAQBF0QLdAABQAAAJAAB4nGVSwW7aQBB9JhDUSq16rHraH4hliFAScYNYQQoQ2jRw6mGBNbYw3mhZIiX9iX5DLjn1H3qqVKmnXvo7fV6vQtWCvH7zZubNzI4BvMF3BKh+b9H2OEADM49raGLj8QFjnjyuM+anxw0MgqXHh3gV/PC4ife1z8wK6i9oRU6hxAFe4tLjGl7jk8cHjNl5XGfMN48b+IJfHh/iXfDV4yYeg9/oQWILhSUENAqeAzIFnwdnazIjZEQLpLTQk1u1FLoQA1nIB11oMcqKRUrPR47dwxAXhLPekK8PFF6xqZxyhqZa7XJJ0ELIZiO+u7jhMDOMifb5R/9mtsIoanVvLmfjrpM+epb6v+iUqYYzZX6ev4tNcE2msvZsOZflfGX83XNGiBOeXe5PYk3NMiYhm1N5zm2H6LjnFMe0zph3jpjVY3ZzxUojojH7w1SZbcYLq4aYXAu+HEy1XejirnSEJ1F3I9dK2yTMs3k77ISd0+P2mTiPp/HwajKKx1SqVtNnK4Z/xZatHxPcRl8boxaWpcDyOf3VaoWLTdy1CGZod6bOU2rd4p6ejPedkhcuZ68smKl9ZpWTON46xrDGkuzG7WlNTpK1Tm/O/e1VCneBGZUVK4RsMVf8lIRRiTLCamFTJfr69t5kq9SKbTWJSLRxnkQXVlgjl2ojzVpIa00237mQQttsobYh/gBlXahAAHicY2BmAIP/sxiMGLAAACpVAc8A) format("woff"),url(data:font/otf;base64,T1RUTwAJAIAAAwAQQ0ZGIJKPGSsAAAV0AAABPE9TLzJk82fyAAABAAAAAGBjbWFwAIMBOwAABMwAAACGaGVhZADsRdkAAACcAAAANmhoZWEF9gEwAAAA1AAAACRobXR4D88AAAAABrAAAAAibWF4cAAJUAAAAAD4AAAABm5hbWUQl1KGAAABYAAAA2xwb3N0/50AMgAABVQAAAAgAAEAAAABAACo8vYlXw889QADBAAAAAAAzosoUwAAAADRVtnSAAAAAAH0ArwAAAADAAIAAAAAAAAAAQAAAzP/MwDNAfQAAAAAAfQAAQAAAAAAAAAAAAAAAAAAAAgAAFAAAAkAAAADAcEBLAAFAAgCmQJmAAAATAKZAmYAAAFmADIA4QAAAAAFAAAAAAAAAAAAACACCgAAAQAAAAAAAABVS1dOAAAAAAAgAzP/MwDNBAAAzQAAAAEAAAAAAAAAAAAgACAAAAAAABAAxgABAAAAAAAAABgAAAABAAAAAAABAAUAGAABAAAAAAACAAcAHQABAAAAAAADABgAJAABAAAAAAAEAAUAGAABAAAAAAAFAEgAPAABAAAAAAAGAA0AhAABAAAAAAAHAFEAkQADAAEECQAAADAA4gADAAEECQABAAoBEgADAAEECQACAA4BHAADAAEECQADADABKgADAAEECQAEAAoBEgADAAEECQAFAJABWgADAAEECQAGABoB6gADAAEECQAHAKICBEJhc2VkIG9uIEhhbmF6b25vIE1pbmNob1RXQkxHUmVndWxhcjEuMDAxO1VLV047VFdCTEctUmVndWxhclZlcnNpb24gMS4wMDE7UFMgMDAxLjAwMTtob3Rjb252IDEuMC43MDttYWtlb3RmLmxpYjIuNS41ODMyOSBERVZFTE9QTUVOVFRXQkxHLVJlZ3VsYXJQbGVhc2UgcmVmZXIgdG8gdGhlIENvcHlyaWdodCBzZWN0aW9uIGZvciB0aGUgZm9udCB0cmFkZW1hcmsgYXR0cmlidXRpb24gbm90aWNlcy4AQgBhAHMAZQBkACAAbwBuACAASABhAG4AYQB6AG8AbgBvACAATQBpAG4AYwBoAG8AVABXAEIATABHAFIAZQBnAHUAbABhAHIAMQAuADAAMAAxADsAVQBLAFcATgA7AFQAVwBCAEwARwAtAFIAZQBnAHUAbABhAHIAVgBlAHIAcwBpAG8AbgAgADEALgAwADAAMQA7AFAAUwAgADAAMAAxAC4AMAAwADEAOwBoAG8AdABjAG8AbgB2ACAAMQAuADAALgA3ADAAOwBtAGEAawBlAG8AdABmAC4AbABpAGIAMgAuADUALgA1ADgAMwAyADkAIABEAEUAVgBFAEwATwBQAE0ARQBOAFQAVABXAEIATABHAC0AUgBlAGcAdQBsAGEAcgBQAGwAZQBhAHMAZQAgAHIAZQBmAGUAcgAgAHQAbwAgAHQAaABlACAAQwBvAHAAeQByAGkAZwBoAHQAIABzAGUAYwB0AGkAbwBuACAAZgBvAHIAIAB0AGgAZQAgAGYAbwBuAHQAIAB0AHIAYQBkAGUAbQBhAHIAawAgAGEAdAB0AHIAaQBiAHUAdABpAG8AbgAgAG4AbwB0AGkAYwBlAHMALgAAAAMAAAADAAAAVgABAAAAAAAcAAMAAQAAAFYABgA6AAAACQAYAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAQAMAAAAAgACAACAAAAAAANACD//wAAAAAADQAg//8ACP/1/+MAAQAAAAAAAAAAAAAAAwAAAAAAAP+aADIAAAAAAAAAAAAAAAAAAAAAAAAAAAEABAIAAQEBDkhhbkNvcnJlY3Rpb24AAQEBOfgQAPgiAfgjAvgjA/gYBPsTDAOLi/iI+VAFHqAAl2Vi/4uLHqAAl2Vi/4uLDAf3Vw/3YRGO980SAAkBAQMJEyExNTxUYkNSQ1IuMDAxc3BhY2UuZnJhY2ZpZ3VyZXNwYWNlLnRmZmlndXJlc3BhY2UudG9zZl81Njh1bmkwMDAwQmFzZWQgb24gSGFuYXpvbm8gTWluY2hvSGFuIENvcnJlY3Rpb24AAAEBhwEAAQABiQQACQEBS05RVFZZXF5g+IiLvfjsvQGLvfgkvQP4iBb5UPyI/VAH2/keFffoBvs++5MF91z3ZhX8kgf7PveTBW1eFfc++5MF++gG9yD3wBX7PvuTBfiSBw736Q76rA76eg6zDvjEDvjEDosOiw6LiwYB9AAAAVUAAAQYAAAD5gAAACgAAAIwAAACMAAAAAAAAAAAAAA=) format("opentype");font-family:Han Space;unicode-range:U+20}h-char.bd-hangable:lang(zh) h-cs,h-char.bd-hangable:lang(zh) h-cs[hidden],h-char.bd-hangable:lang(zh-Hant) h-cs,h-char.bd-hangable:lang(zh-Hant) h-cs[hidden],h-char.bd-hangable:lang(zh-HK) h-cs,h-char.bd-hangable:lang(zh-HK) h-cs[hidden],h-char.bd-hangable:lang(zh-TW) h-cs,h-char.bd-hangable:lang(zh-TW) h-cs[hidden]{display:inline;visibility:inherit;font-family:inherit;font-size:inherit}h-cs.hangable-outer,h-cs.hangable-outer[hidden]{display:inline;font:1em Han Space}h-cs.hangable-outer:lang(zh-Hant),h-cs.hangable-outer:lang(zh-HK),h-cs.hangable-outer:lang(zh-TW),h-cs.hangable-outer[hidden]:lang(zh-Hant),h-cs.hangable-outer[hidden]:lang(zh-HK),h-cs.hangable-outer[hidden]:lang(zh-TW){display:none}h-char.bd-hangable:lang(ja),h-char.bd-hangable:lang(zh-CN),h-char.bd-hangable:lang(zh-Hans){position:relative}h-char.bd-hangable:lang(ja):after,h-char.bd-hangable:lang(zh-CN):after,h-char.bd-hangable:lang(zh-Hans):after{display:none!important}h-char.bd-hangable:lang(ja):before,h-char.bd-hangable:lang(zh-CN):before,h-char.bd-hangable:lang(zh-Hans):before{display:inline!important;content:" ";font:1em Han Space,Menlo,Consolas,Courier}h-char.bd-hangable:lang(ja)>h-inner,h-char.bd-hangable:lang(zh-CN)>h-inner,h-char.bd-hangable:lang(zh-Hans)>h-inner{-moz-text-emphasis:none;-webkit-text-emphasis:none;text-emphasis:none;font-style:normal;font-weight:400;line-height:normal;text-decoration:none;text-indent:0;position:absolute;left:0;top:0;display:inline-block;line-height:1.1}h-ru h-char.bd-hangable:lang(ja)>h-inner,h-ru h-char.bd-hangable:lang(zh-CN)>h-inner,h-ru h-char.bd-hangable:lang(zh-Hans)>h-inner,ruby h-char.bd-hangable:lang(ja)>h-inner,ruby h-char.bd-hangable:lang(zh-CN)>h-inner,ruby h-char.bd-hangable:lang(zh-Hans)>h-inner{position:relative}h-char.bd-jiya.bd-end:after,h-char.bd-jiya.bd-open:before,h-cs,h-cs[hidden]{display:none;visibility:hidden;content:" ";font:.825em Courier;letter-spacing:0;white-space:normal}h-cs.jinze-outer,h-cs.jinze-outer[hidden]{display:inline}h-char.bd-jiya.bd-open>h-inner{margin-left:-.5em}h-char.bd-jiya.bd-close>h-inner,h-char.bd-jiya.bd-cop>h-inner,h-char.bd-jiya[unicode=ff0e]>h-inner{letter-spacing:-.5em}h-char.bd-jiya.bd-close:after,h-char.bd-jiya.bd-cop:after,h-char.bd-jiya.bd-open:before,h-char.bd-jiya[unicode=ff0e]:after{display:inline}h-char.bd-jiya.bd-cop:lang(zh-Hant):after,h-char.bd-jiya.bd-cop:lang(zh-HK):after,h-char.bd-jiya.bd-cop:lang(zh-TW):after{display:none}h-char.bd-jiya.bd-cop:lang(zh-Hant)>h-inner,h-char.bd-jiya.bd-cop:lang(zh-HK)>h-inner,h-char.bd-jiya.bd-cop:lang(zh-TW)>h-inner{letter-spacing:inherit}h-char.bd-consecutive.bd-end:not(.end-portion):after,h-char.bd-consecutive.bd-open[prev=bd-open]:before,h-cs.jiya-outer.bd-end:not(.end-portion){display:none}h-cs.jiya-outer.bd-end[next=bd-open]{display:inline}h-char.bd-consecutive.bd-open[prev*=bd-cop]:lang(zh-Hant):before,h-char.bd-consecutive.bd-open[prev*=bd-cop]:lang(zh-HK):before,h-char.bd-consecutive.bd-open[prev*=bd-cop]:lang(zh-TW):before,h-cs.jiya-outer.bd-end:lang(zh-Hant),h-cs.jiya-outer.bd-end:lang(zh-HK),h-cs.jiya-outer.bd-end:lang(zh-TW),h-cs.jiya-outer[prev*=bd-cop]{display:none}h-char.bd-consecutive[unicode="30fb"]:not(.end-portion),h-char.bd-consecutive[unicode=b7]:not(.end-portion){letter-spacing:-.5em}h-char.bd-consecutive.bd-liga:not(.end-portion){margin-right:-.25em}h-char[display-as]{position:relative;display:inline-block}h-char[display-as] h-inner{color:transparent}h-char[display-as]:after{position:absolute;left:0;display:inline-block;content:attr(display-as)}h-char[display-as].comb-liga:after{font-family:Romanization Sans,Zhuyin Kaiti}</style><meta name="generator" content="Gatsby 2.32.3"/><link rel="canonical" href="https://raptazure.github.io/posts/rust-patterns/" data-baseprotocol="https:" data-basehost="raptazure.github.io"/><link rel="icon" href="/favicon-32x32.png?v=66298ac869c312fbdefc1ee9aad6e319" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#ffffff"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=66298ac869c312fbdefc1ee9aad6e319"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=66298ac869c312fbdefc1ee9aad6e319"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=66298ac869c312fbdefc1ee9aad6e319"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=66298ac869c312fbdefc1ee9aad6e319"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=66298ac869c312fbdefc1ee9aad6e319"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=66298ac869c312fbdefc1ee9aad6e319"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=66298ac869c312fbdefc1ee9aad6e319"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=66298ac869c312fbdefc1ee9aad6e319"/><link rel="alternate" type="application/rss+xml" title="Meditation | RSS Feed" href="/rss.xml"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><title data-react-helmet="true">Rust Idioms | Raptazure</title><link data-react-helmet="true" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"/><meta data-react-helmet="true" name="description" content="Meditation"/><meta data-react-helmet="true" name="keywords" content="blog, gatsbyjs, computer-science"/><meta data-react-helmet="true" name="google-site-verification" content=""/><meta data-react-helmet="true" name="baidu-site-verification" content=""/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="@iimtsuki"/><meta data-react-helmet="true" name="twitter:site" content="@iimtsuki"/><meta data-react-helmet="true" name="twitter:title" content="Rust Idioms | Raptazure"/><link as="script" rel="preload" href="/webpack-runtime-1759ea2bc116b1543164.js"/><link as="script" rel="preload" href="/framework-305b3707783ccc9d7ca6.js"/><link as="script" rel="preload" href="/app-88d13f99ef23aa1fa235.js"/><link as="script" rel="preload" href="/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/e30115b4d33dc6d7723ba506c53f6f70ec229815-7037690d8a5360ce8426.js"/><link as="script" rel="preload" href="/component---src-templates-post-tsx-a8605c1ce88d408d0128.js"/><link as="fetch" rel="preload" href="/page-data/posts/rust-patterns/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2345487092.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion-css="1tl2ur9">html{box-sizing:border-box;}*,*::before,*::after{box-sizing:inherit;}html{font-size:18px !important;line-height:1.45 !important;font-variant-numeric:lining-nums;}body{width:100%;overflow-x:hidden;overflow-y:scroll;color:#000;background-color:#fffff9;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;}a{color:#000;-webkit-text-decoration:none;text-decoration:none;}a:hover,a:focus{-webkit-text-decoration:underline;text-decoration:underline;}article a{-webkit-text-decoration:underline;text-decoration:underline;}img{max-width:100%;object-fit:contain;position:relative;}figure{margin:2rem 0;}figcaption{font-size:80%;}table{width:100%;margin-bottom:1rem;border:1px solid #f5f3f7;font-size:85%;border-collapse:collapse;}td,th{padding:.25rem .5rem;border:1px solid #f5f3f7;}th{text-align:left;}tbody tr:nth-of-type(odd) td{background-color:#fbfafc;}tbody tr:nth-of-type(odd) tr{background-color:#fbfafc;}dt{font-weight:bold;}dd{margin-bottom:.5rem;}hr{position:relative;margin:1.5rem 0;border:0;border-top:1px solid #f5f3f7;}blockquote{margin:0 0;border-left:.2rem solid #777;color:#777;padding-left:1rem;}blockquote p{margin-top:0;margin-bottom:0;}@media (min-width:26.666666666666668em){blockquote{padding-right:5rem;}}pre,code,kbd{font-variant-ligatures:none;}.katex{font-size:1em !important;}.katex-display > .katex{max-width:100%;}.katex-display > .katex > .katex-html{max-width:100%;overflow-x:auto;overflow-y:hidden;}.footnotes{font-size:0.8rem;}.footnote-backref,.footnote-ref{-webkit-text-decoration:none;text-decoration:none;}</style><style data-emotion-css="zf0iqh">.css-zf0iqh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;}</style><div class="css-zf0iqh ekje2240"><style data-emotion-css="1wvahdb">.css-1wvahdb{height:100px;padding:0 1.5rem;color:rgba(255,255,249,0.5);}</style><header class="css-1wvahdb e1xhtnev0"><style data-emotion-css="1gxlvne">.css-1gxlvne{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:100%;-webkit-flex:4 1 120px;-ms-flex:4 1 120px;flex:4 1 120px;}</style><style data-emotion-css="o8vgh1">.css-o8vgh1{position:relative;margin-left:auto;margin-right:auto;width:auto;max-width:40em;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:100%;-webkit-flex:4 1 120px;-ms-flex:4 1 120px;flex:4 1 120px;}</style><div class="e1xhtnev1 css-o8vgh1 eqdtqc0"><style data-emotion-css="1kayfef">.css-1kayfef{color:#000;font-size:2.2rem;margin-right:1rem;font-family:'Dancing Script',cursive;}.css-1kayfef:hover,.css-1kayfef:focus{-webkit-text-decoration:none;text-decoration:none;}</style><a class="css-1kayfef e1xhtnev2" href="/">Meditation</a><style data-emotion-css="o2j9ze">.css-o2j9ze{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}</style><div class="css-o2j9ze e1xhtnev4"><style data-emotion-css="xlrezp">.css-xlrezp{color:#000;font-size:1rem;margin-left:1rem;}.css-xlrezp:hover,.css-xlrezp:focus{-webkit-text-decoration:none;text-decoration:none;}</style><a class="css-xlrezp e1xhtnev3" href="/about">About</a><a class="css-xlrezp e1xhtnev3" href="/friends">Friends</a></div></div></header><style data-emotion-css="b95f0i">.css-b95f0i{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-flex:1;-ms-flex:1;flex:1;}</style><main class="css-b95f0i e15xeevy0"><style data-emotion-css="pcbh56">.css-pcbh56{display:block;-webkit-flex:1;-ms-flex:1;flex:1;position:relative;padding:1.5rem;margin-bottom:3rem;}</style><div class="css-pcbh56 e1xri82u0"><style data-emotion-css="1edd6f2">.css-1edd6f2{position:relative;margin-left:auto;margin-right:auto;width:auto;max-width:40em;}</style><div class="css-1edd6f2 eqdtqc0"><article lang="zh-Hans"><h1>Rust Idioms</h1><style data-emotion-css="16dlb2j">.css-16dlb2j{color:#808080;min-width:200px;margin-right:1rem;font-size:0.9rem;font-variant-numeric:tabular-nums lining-nums;}</style><time class="css-16dlb2j e17ylof40">2021-01-07</time><style data-emotion-css="6cic6e">.css-6cic6e{color:#808080;min-width:200px;margin-right:0.5em;font-size:0.9rem;font-variant-numeric:tabular-nums lining-nums;text-transform:uppercase;}.css-6cic6e:before{content:'#';}</style><span class="css-6cic6e ev9klxm0">rust</span><h2>1. Use borrowed types for arguments</h2><p>Using a target of a deref coercion can increase the flexibility of your code when you are deciding which argument type to use for a function argument. In this way, the function will accept more input types. Always prefer using the borrowed type over borrowing the owned type. For example, use <code class="language-text">&amp;str</code> over <code class="language-text">&amp;String</code>, <code class="language-text">&amp;[T]</code> over <code class="language-text">&amp;Vec&lt;T&gt;</code>, <code class="language-text">&amp;T</code> over <code class="language-text">&amp;Box&lt;T&gt;</code>. </p><h2>2. Concatenating strings with <code class="language-text">format!</code></h2><p>It is usually the most succinct and readable way to combine strings, although a series of push operations on a mutable string is usually the most efficient.</p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">say_hello</span><span class="token punctuation">(</span>name <span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
  <span class="token macro property">fomat!</span><span class="token punctuation">(</span><span class="token string">&quot;Hello {}!&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div><h2>3. Constructors</h2><p>Use a static <code class="language-text">new</code> method to create an object.</p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    buf<span class="token punctuation">:</span> <span class="token class-name">RawVec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    len<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Constructs a new, empty `Vec&lt;T&gt;`.</span>
    <span class="token comment">// Note this is a static method - no self.</span>
    <span class="token comment">// This constructor doesn&#x27;t take any arguments, but some </span>
    <span class="token comment">// might in order to properly initialise an object</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// Create a new Vec with fields properly initialised.</span>
        <span class="token class-name">Vec</span> <span class="token punctuation">{</span>
            <span class="token comment">// Note that here we are calling RawVec&#x27;s constructor.</span>
            buf<span class="token punctuation">:</span> <span class="token class-name">RawVec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            len<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><h2>4. The Default Trait</h2><p>Many types in Rust have a constructor. However, this is specific to the type; Rust cannot abstract over everything that has a new() method. To allow this, the Default trait was conceived, which can be used with containers and other generic types.</p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token attribute attr-name">#[derive(Default, Debug)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">MyConfiguration</span> <span class="token punctuation">{</span>
  <span class="token comment">// Option defaults to None</span>
  output<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">PathBuf</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token comment">// Vecs default to empty vector</span>
  search_path<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">PathBuf</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token comment">// Duration defaults to zero time</span>
  timeout<span class="token punctuation">:</span> <span class="token class-name">Duration</span><span class="token punctuation">,</span>
  <span class="token comment">// bool defaults to false</span>
  check<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">MyConfiguration</span> <span class="token punctuation">{</span>
    <span class="token comment">// add setters here</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// construct a new instance with default values</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> conf <span class="token operator">=</span> <span class="token class-name">MyConfiguration</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// do something with conf here</span>
    conf<span class="token punctuation">.</span>check <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;conf = {:#?}&quot;</span><span class="token punctuation">,</span> conf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div><h2>5. Collections are smart pointers</h2><p>Use the Deref trait to treat collections like smart pointers, offering owning and borrowed views of data. Ownership and borrowing are key aspects of the Rust language. Data structures must account for these semantics properly in order to give a good user experience. When implementing a data structure which owns its data, offering a borrowed view of that data allows for more flexible APIs.</p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span></span><span class="token class-name">Deref</span><span class="token punctuation">;</span>

<span class="token comment">// A Vec&lt;T&gt; is an owning collection of Ts</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  data<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span>
  <span class="token comment">// ..</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">Deref</span> <span class="token keyword">for</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// A slice (&amp;[T]) is a borrowed collection of Ts</span>
  <span class="token keyword">type</span> <span class="token class-name">Target</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">// Implementing Deref for Vec allows implicit dereferencing from </span>
  <span class="token comment">// &amp;Vec&lt;T&gt; to &amp;[T] and includes the relationship in auto-derefencing </span>
  <span class="token comment">// searches.</span>
  <span class="token keyword">fn</span> <span class="token function-definition function">deref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
    <span class="token comment">// ..</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><h2>6. Finalisation in destructors</h2><p>In Rust, destructors are run when an object goes out of scope. This happens whether we reach the end of block, there is an early return, or the program panics. When panicking, Rust unwinds the stack running destructors for each object in each stack frame. So, destructors get called even if the panic happens in a function being called.</p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// These don&#x27;t need to be defined inside the function.</span>
    <span class="token keyword">struct</span> <span class="token type-definition class-name">Foo</span><span class="token punctuation">;</span>

    <span class="token comment">// Implement a destructor for Foo.</span>
    <span class="token keyword">impl</span> <span class="token class-name">Drop</span> <span class="token keyword">for</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
        <span class="token keyword">fn</span> <span class="token function-definition function">drop</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;exit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// The dtor of _exit will run however </span>
    <span class="token comment">// the function `bar` is exited.</span>
    <span class="token keyword">let</span> _exit <span class="token operator">=</span> <span class="token class-name">Foo</span><span class="token punctuation">;</span>
    <span class="token comment">// Implicit return with `?` operator.</span>
    <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token comment">// Normal return.</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div><h2>7. <code class="language-text">mem::replace</code> to keep owned values in changed enums</h2><p>Say we have a &amp;mut MyEnum which has (at least) two variants, A { name: String, x: u8 } and B { name: String }. Now we want to change MyEnum::A to a B if x is zero, while keeping MyEnum::B intact. We can do this without cloning the name. If we are using an Option and want to replace its value with a None, Option’s take() method provides a shorter and more idiomatic alternative. This gets rid of the <!-- -->[Clone to satisfy the borrow checker]<!-- --> antipattern in a specific case and there is no allocation.</p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>mem<span class="token punctuation">;</span>

<span class="token keyword">enum</span> <span class="token type-definition class-name">MyEnum</span> <span class="token punctuation">{</span>
    <span class="token class-name">A</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> x<span class="token punctuation">:</span> <span class="token keyword">u8</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token class-name">B</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">a_to_b</span><span class="token punctuation">(</span>e<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">MyEnum</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// we mutably borrow `e` here. This precludes us from changing it directly</span>
    <span class="token comment">// as in `*e = ...`, because the borrow checker won&#x27;t allow it. Therefore</span>
    <span class="token comment">// the assignment to `e` must be outside the `if let` clause.</span>
    <span class="token operator">*</span>e <span class="token operator">=</span> <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">MyEnum</span><span class="token punctuation">::</span><span class="token class-name">A</span> <span class="token punctuation">{</span> <span class="token keyword">ref</span> <span class="token keyword">mut</span> name<span class="token punctuation">,</span> x<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token operator">*</span>e <span class="token punctuation">{</span>

        <span class="token comment">// this takes out our `name` and put in an empty String instead</span>
        <span class="token comment">// (note that empty strings don&#x27;t allocate).</span>
        <span class="token comment">// Then, construct the new enum variant (which will</span>
        <span class="token comment">// be assigned to `*e`, because it is the result of the `if let` expression).</span>
        <span class="token class-name">MyEnum</span><span class="token punctuation">::</span><span class="token class-name">B</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">replace</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>

    <span class="token comment">// In all other cases, we return immediately, thus skipping the assignment</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><h2>8. On-Stack Dynamic Dispatch</h2><p>We can dynamically dispatch over multiple values, however, to do so, we need to declare multiple variables to bind differently-typed objects. To extend the lifetime as necessary, we can use deferred conditional initialization. </p><p>Rust monomorphises code by default. This means a copy of the code will be generated for each type it is used with and optimized independently. While this allows for very fast code on the hot path, it also bloats the code in places where performance is not of the essence, thus costing compile time and cache usage.</p><p>Luckily, Rust allows us to use dynamic dispatch, but we have to explicitly ask for it.</p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>io<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>fs<span class="token punctuation">;</span>

<span class="token comment">// These must live longer than `readable`, and thus are declared first:</span>
<span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token keyword">mut</span> stdin_read<span class="token punctuation">,</span> <span class="token keyword">mut</span> file_read<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// We need to ascribe the type to get dynamic dispatch.</span>
<span class="token keyword">let</span> readable<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">dyn</span> <span class="token namespace">io<span class="token punctuation">::</span></span><span class="token class-name">Read</span> <span class="token operator">=</span> <span class="token keyword">if</span> arg <span class="token operator">==</span> <span class="token string">&quot;-&quot;</span> <span class="token punctuation">{</span>
    stdin_read <span class="token operator">=</span> <span class="token namespace">io<span class="token punctuation">::</span></span><span class="token function">stdin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token keyword">mut</span> stdin_read
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    file_read <span class="token operator">=</span> <span class="token namespace">fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token keyword">mut</span> file_read
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Read from `readable` here.</span></code></pre></div><h2>9. FFI Idioms</h2><h4>Error Handling in FFI</h4><ul><li>Flat Enums should be converted to integers and returned as codes.</li></ul><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token keyword">enum</span> <span class="token type-definition class-name">DatabaseError</span> <span class="token punctuation">{</span>
    <span class="token class-name">IsReadOnly</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// user attempted a write operation</span>
    <span class="token class-name">IOError</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// user should read the C errno() for what it was</span>
    <span class="token class-name">FileCorrupted</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// user should run a repair tool to recover it</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">From</span><span class="token operator">&lt;</span><span class="token class-name">DatabaseError</span><span class="token operator">&gt;</span> <span class="token keyword">for</span> <span class="token namespace">libc<span class="token punctuation">::</span></span>c_int <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">from</span><span class="token punctuation">(</span>e<span class="token punctuation">:</span> <span class="token class-name">DatabaseError</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token namespace">libc<span class="token punctuation">::</span></span>c_int <span class="token punctuation">{</span>
        <span class="token punctuation">(</span>e <span class="token keyword">as</span> <span class="token keyword">i8</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><ul><li>Structured Enums should be converted to an integer code with a string error message for detail.</li></ul><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">mod</span> <span class="token module-declaration namespace">errors</span> <span class="token punctuation">{</span>
    <span class="token keyword">enum</span> <span class="token type-definition class-name">DatabaseError</span> <span class="token punctuation">{</span>
        <span class="token class-name">IsReadOnly</span><span class="token punctuation">,</span>
        <span class="token class-name">IOError</span><span class="token punctuation">(</span><span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">FileCorrupted</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// message describing the issue</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">impl</span> <span class="token class-name">From</span><span class="token operator">&lt;</span><span class="token class-name">DatabaseError</span><span class="token operator">&gt;</span> <span class="token keyword">for</span> <span class="token namespace">libc<span class="token punctuation">::</span></span>c_int <span class="token punctuation">{</span>
        <span class="token keyword">fn</span> <span class="token function-definition function">from</span><span class="token punctuation">(</span>e<span class="token punctuation">:</span> <span class="token class-name">DatabaseError</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token namespace">libc<span class="token punctuation">::</span></span>c_int <span class="token punctuation">{</span>
            <span class="token keyword">match</span> e <span class="token punctuation">{</span>
                <span class="token class-name">DatabaseError</span><span class="token punctuation">::</span><span class="token class-name">IsReadOnly</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token class-name">DatabaseError</span><span class="token punctuation">::</span><span class="token class-name">IOError</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">2</span><span class="token punctuation">,</span>
                <span class="token class-name">DatabaseError</span><span class="token punctuation">::</span><span class="token class-name">FileCorrupted</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">pub</span> <span class="token keyword">mod</span> <span class="token module-declaration namespace">c_api</span> <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token keyword">super</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>errors<span class="token punctuation">::</span></span><span class="token class-name">DatabaseError</span><span class="token punctuation">;</span>

    <span class="token attribute attr-name">#[no_mangle]</span>
    <span class="token keyword">pub</span> <span class="token keyword">extern</span> <span class="token string">&quot;C&quot;</span> <span class="token keyword">fn</span> <span class="token function-definition function">db_error_description</span><span class="token punctuation">(</span>
        e<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">const</span> <span class="token class-name">DatabaseError</span>
        <span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">*</span><span class="token keyword">mut</span> <span class="token namespace">libc<span class="token punctuation">::</span></span>c_char <span class="token punctuation">{</span>

        <span class="token keyword">let</span> error<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">DatabaseError</span> <span class="token operator">=</span> <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
            <span class="token comment">/* SAFETY: pointer lifetime is greater than the current stack frame */</span>
            <span class="token operator">&amp;</span><span class="token operator">*</span>e
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">let</span> error_str<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token keyword">match</span> error <span class="token punctuation">{</span>
            <span class="token class-name">DatabaseError</span><span class="token punctuation">::</span><span class="token class-name">IsReadOnly</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">&quot;cannot write to read-only database&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">DatabaseError</span><span class="token punctuation">::</span><span class="token class-name">IOError</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">&quot;I/O Error: {}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">DatabaseError</span><span class="token punctuation">::</span><span class="token class-name">FileCorrupted</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">&quot;File corrupted, run repair: {}&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">let</span> c_error <span class="token operator">=</span> <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
            <span class="token comment">// SAFETY: copying error_str to an allocated buffer with a NUL</span>
            <span class="token comment">// character at the end</span>
            <span class="token keyword">let</span> <span class="token keyword">mut</span> malloc<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">mut</span> <span class="token keyword">u8</span> <span class="token operator">=</span> <span class="token namespace">libc<span class="token punctuation">::</span></span><span class="token function">malloc</span><span class="token punctuation">(</span>error_str<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token operator">*</span><span class="token keyword">mut</span> _<span class="token punctuation">;</span>

            <span class="token keyword">if</span> malloc<span class="token punctuation">.</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token namespace">std<span class="token punctuation">::</span>ptr<span class="token punctuation">::</span></span><span class="token function">null_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">let</span> src <span class="token operator">=</span> error_str<span class="token punctuation">.</span><span class="token function">as_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token namespace">std<span class="token punctuation">::</span>ptr<span class="token punctuation">::</span></span><span class="token function">copy_nonoverlapping</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> malloc<span class="token punctuation">,</span> error_str<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token namespace">std<span class="token punctuation">::</span>ptr<span class="token punctuation">::</span></span><span class="token function">write</span><span class="token punctuation">(</span>malloc<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>error_str<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            malloc <span class="token keyword">as</span> <span class="token operator">*</span><span class="token keyword">mut</span> <span class="token namespace">libc<span class="token punctuation">::</span></span>c_char
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        c_error
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><ul><li>Custom Error Types should become transparent, with a C representation.</li></ul><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">ParseError</span> <span class="token punctuation">{</span>
    expected<span class="token punctuation">:</span> <span class="token keyword">char</span><span class="token punctuation">,</span>
    line<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
    ch<span class="token punctuation">:</span> <span class="token keyword">u16</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">ParseError</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span>

<span class="token comment">/* Create a second version which is exposed as a C structure */</span>
<span class="token attribute attr-name">#[repr(C)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">parse_error</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> expected<span class="token punctuation">:</span> <span class="token namespace">libc<span class="token punctuation">::</span></span>c_char<span class="token punctuation">,</span>
    <span class="token keyword">pub</span> line<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> ch<span class="token punctuation">:</span> <span class="token keyword">u16</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">From</span><span class="token operator">&lt;</span><span class="token class-name">ParseError</span><span class="token operator">&gt;</span> <span class="token keyword">for</span> parse_error <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">from</span><span class="token punctuation">(</span>e<span class="token punctuation">:</span> <span class="token class-name">ParseError</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> parse_error <span class="token punctuation">{</span>
        <span class="token keyword">let</span> <span class="token class-name">ParseError</span> <span class="token punctuation">{</span> expected<span class="token punctuation">,</span> line<span class="token punctuation">,</span> ch <span class="token punctuation">}</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
        parse_error <span class="token punctuation">{</span> expected<span class="token punctuation">,</span> line<span class="token punctuation">,</span> ch <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><h4>Accepting Strings</h4><p>When accepting strings via FFI through pointers, there are two principles that should be followed:</p><ul><li>Keep foreign strings borrowed, rather than copying them directly.</li><li>Minimize <code class="language-text">unsafe</code> code during the conversion.</li></ul><p>The best practice is simple: use CStr in such a way as to minimize unsafe code, and create a borrowed slice. If an owned String is needed, call to_string() on the string slice.</p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">mod</span> <span class="token module-declaration namespace">unsafe_module</span> <span class="token punctuation">{</span>
    
    <span class="token comment">// other module content</span>

    <span class="token attribute attr-name">#[no_mangle]</span>
    <span class="token keyword">pub</span> <span class="token keyword">extern</span> <span class="token string">&quot;C&quot;</span> <span class="token keyword">fn</span> <span class="token function-definition function">mylib_log</span><span class="token punctuation">(</span>msg<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">const</span> <span class="token namespace">libc<span class="token punctuation">::</span></span>c_char<span class="token punctuation">,</span> level<span class="token punctuation">:</span> <span class="token namespace">libc<span class="token punctuation">::</span></span>c_int<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> level<span class="token punctuation">:</span> <span class="token keyword">crate</span><span class="token punctuation">::</span><span class="token class-name">LogLevel</span> <span class="token operator">=</span> <span class="token keyword">match</span> level <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">let</span> msg_str<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token operator">=</span> <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
            <span class="token comment">// SAFETY: accessing raw pointers expected to live for the call,</span>
            <span class="token comment">// and creating a shared reference that does not outlive the current</span>
            <span class="token comment">// stack frame.</span>
            <span class="token keyword">match</span> <span class="token namespace">std<span class="token punctuation">::</span>ffi<span class="token punctuation">::</span></span><span class="token class-name">CStr</span><span class="token punctuation">::</span><span class="token function">from_ptr</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Ok</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">,</span>
                <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>log_error</span><span class="token punctuation">(</span><span class="token string">&quot;FFI string conversion failed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>log</span><span class="token punctuation">(</span>msg_str<span class="token punctuation">,</span> level<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><h4>Passing Strings</h4><p>When passing strings to FFI functions, there are four principles that should be followed:</p><ul><li>Make the lifetime of owned strings as long as possible.</li><li>Minimize unsafe code during the conversion.</li><li>If the C code can modify the string data, use Vec instead of CString.</li><li>Unless the Foreign Function API requires it, the ownership of the string should not transfer to the callee.</li></ul><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">mod</span> <span class="token module-declaration namespace">unsafe_module</span> <span class="token punctuation">{</span>

    <span class="token comment">// other module content</span>

    <span class="token keyword">extern</span> <span class="token string">&quot;C&quot;</span> <span class="token punctuation">{</span>
        <span class="token keyword">fn</span> <span class="token function-definition function">seterr</span><span class="token punctuation">(</span>message<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">const</span> <span class="token namespace">libc<span class="token punctuation">::</span></span>c_char<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">fn</span> <span class="token function-definition function">geterr</span><span class="token punctuation">(</span>buffer<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">mut</span> <span class="token namespace">libc<span class="token punctuation">::</span></span>c_char<span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token namespace">libc<span class="token punctuation">::</span></span>c_int<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token namespace">libc<span class="token punctuation">::</span></span>c_int<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">report_error_to_ffi</span><span class="token operator">&lt;</span><span class="token class-name">S</span><span class="token punctuation">:</span> <span class="token class-name">Into</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>
        err<span class="token punctuation">:</span> <span class="token class-name">S</span>
    <span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token namespace">std<span class="token punctuation">::</span>ffi<span class="token punctuation">::</span></span><span class="token class-name">NulError</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> c_err <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>ffi<span class="token punctuation">::</span></span><span class="token class-name">CString</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

        <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
            <span class="token comment">// SAFETY: calling an FFI whose documentation says the pointer is</span>
            <span class="token comment">// const, so no modificationshould occur</span>
            <span class="token function">seterr</span><span class="token punctuation">(</span>c_err<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">// The lifetime of c_err continues until here</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">get_error_from_ffi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token namespace">std<span class="token punctuation">::</span>ffi<span class="token punctuation">::</span></span><span class="token class-name">IntoStringError</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> <span class="token keyword">mut</span> buffer <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">0u8</span><span class="token punctuation">;</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
            <span class="token comment">// SAFETY: calling an FFI whose documentation implies</span>
            <span class="token comment">// that the input need only live as long as the call</span>
            <span class="token keyword">let</span> written<span class="token punctuation">:</span> <span class="token keyword">usize</span> <span class="token operator">=</span> <span class="token function">geterr</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">as_mut_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1023</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            buffer<span class="token punctuation">.</span><span class="token function">truncate</span><span class="token punctuation">(</span>written <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token namespace">std<span class="token punctuation">::</span>ffi<span class="token punctuation">::</span></span><span class="token class-name">CString</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><h2>10. Iterating over an Option</h2><p>Option can be viewed as a container that contains either zero or one elements. In particular, it implements the IntoIterator trait, and as such can be used with generic code that needs such a type.</p><ul><li>Since Option implements IntoIterator, it can be used as an argument to <code class="language-text">.extend()</code>:</li></ul><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> turing <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;Turing&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token keyword">mut</span> logicians <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token string">&quot;Curry&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Kleene&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Markov&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

logicians<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>turing<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// equivalent to</span>
<span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>turing_inner<span class="token punctuation">)</span> <span class="token operator">=</span> turing <span class="token punctuation">{</span>
    logicians<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>turing_inner<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div><ul><li>If you need to tack an Option to the end of an existing iterator, you can pass it to <code class="language-text">.chain()</code>:</li></ul><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> turing <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;Turing&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> logicians <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token string">&quot;Curry&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Kleene&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Markov&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> logician <span class="token keyword">in</span> logicians<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">chain</span><span class="token punctuation">(</span>turing<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} is a logician&quot;</span><span class="token punctuation">,</span> logician<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div><ul><li>Also, since Option implements IntoIterator, it’s possible to iterate over it using a for loop. This is equivalent to matching it with if let Some(..), and in most cases you should prefer the latter.</li></ul><h2>11. Pass variables to closure</h2><p>By default, closures capture their environment by borrowing. Or you can use move-closure to move whole environment. However, often you want to move just some variables to closure, give it copy of some data, pass it by reference, or perform some other transformation. Use variable rebinding in separate scope for that.</p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>rc<span class="token punctuation">::</span></span><span class="token class-name">Rc</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> num1 <span class="token operator">=</span> <span class="token class-name">Rc</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> num2 <span class="token operator">=</span> <span class="token class-name">Rc</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> num3 <span class="token operator">=</span> <span class="token class-name">Rc</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> closure <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// `num1` is moved</span>
    <span class="token keyword">let</span> num2 <span class="token operator">=</span> num2<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// `num2` is cloned</span>
    <span class="token keyword">let</span> num3 <span class="token operator">=</span> num3<span class="token punctuation">.</span><span class="token function">as_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// `num3` is borrowed</span>
    <span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
        <span class="token operator">*</span>num1 <span class="token operator">+</span> <span class="token operator">*</span>num2 <span class="token operator">+</span> <span class="token operator">*</span>num3<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div><p>Copied data are grouped together with closure definition, so their purpose is more clear and they will be dropped immediately even if they are not consumed by closure. </p><p>Closure uses same variable names as surrounding code whether data are copied or moved.</p><h2>12. Privacy for extensibility</h2><p>Use a private field to ensure that a struct is extensible without breaking stability guarantees.</p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token keyword">mod</span> <span class="token module-declaration namespace">a</span> <span class="token punctuation">{</span>
    <span class="token comment">// Public struct.</span>
    <span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">S</span> <span class="token punctuation">{</span>
        <span class="token keyword">pub</span> foo<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">;</span>
        <span class="token comment">// Private field</span>
        bar<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token namespace">a<span class="token punctuation">::</span></span><span class="token class-name">S</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Because S::bar is private, it cannot be named here and </span>
    <span class="token comment">// we must use `..` in the pattern.</span>
    <span class="token keyword">let</span> <span class="token namespace">a<span class="token punctuation">::</span></span><span class="token class-name">S</span> <span class="token punctuation">{</span> foo<span class="token punctuation">:</span> _<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token punctuation">}</span> <span class="token operator">=</span> s<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div><h2>13. Easy doc initialization</h2><p>If a struct takes significant effort to initialize, when writing docs, it can be quicker to wrap your example with a helper function which takes the struct as an argument.</p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">Connection</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    stream<span class="token punctuation">:</span> <span class="token class-name">TcpStream</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Connection</span> <span class="token punctuation">{</span>
    <span class="token comment">/// Sends a request over the connection.</span>
    <span class="token comment">///</span>
    <span class="token comment">/// # Example</span>
    <span class="token comment">/// ```no_run</span>
    <span class="token comment">/// # // Boilerplate are required to get an example working.</span>
    <span class="token comment">/// # let stream = TcpStream::connect(&quot;127.0.0.1:34254&quot;);</span>
    <span class="token comment">/// # let connection = Connection { name: &quot;foo&quot;.to_owned(), stream };</span>
    <span class="token comment">/// # let request = Request::new(&quot;RequestId&quot;, RequestType::Get, &quot;payload&quot;);</span>
    <span class="token comment">/// let response = connection.send_request(request);</span>
    <span class="token comment">/// assert!(response.is_ok());</span>
    <span class="token comment">/// ```</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">send_request</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> request<span class="token punctuation">:</span> <span class="token class-name">Request</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Status</span><span class="token punctuation">,</span> <span class="token class-name">SendErr</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/// Oh no, all that boilerplate needs to be repeated here!</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">check_status</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Status</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><p>Instead of typing all of this boiler plate to create an Connection and Request it is easier to just create a wrapping helper function which takes them as arguments:</p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">Connection</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    stream<span class="token punctuation">:</span> <span class="token class-name">TcpStream</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Connection</span> <span class="token punctuation">{</span>
    <span class="token comment">/// Sends a request over the connection.</span>
    <span class="token comment">///</span>
    <span class="token comment">/// # Example</span>
    <span class="token comment">/// ```</span>
    <span class="token comment">/// # fn call_send(connection: Connection, request: Request) {</span>
    <span class="token comment">/// let response = connection.send_request(request);</span>
    <span class="token comment">/// assert!(response.is_ok());</span>
    <span class="token comment">/// # }</span>
    <span class="token comment">/// ```</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">send_request</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> request<span class="token punctuation">:</span> <span class="token class-name">Request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><h2>14. Temporary mutability</h2><p>Often it is necessary to prepare and process some data, but after that data are only inspected and never modified. The intention can be made explicit by redefining the mutable variable as immutable. It can be done either by processing data within nested block or by redefining variable.</p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token comment">// Using nested block</span>
<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> data <span class="token operator">=</span> <span class="token function">get_vec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    data<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    data
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Using variable rebinding</span>
<span class="token keyword">let</span> <span class="token keyword">mut</span> data <span class="token operator">=</span> <span class="token function">get_vec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
data<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> data <span class="token operator">=</span> data

<span class="token comment">// `data` is immutable</span></code></pre></div><h2>15.Builder Pattern</h2><p>Construct an object with calls to a builder helper.</p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug, PartialEq)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Foo</span> <span class="token punctuation">{</span>
    <span class="token comment">// Lots of complicated fields.</span>
    bar<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">FooBuilder</span> <span class="token punctuation">{</span>
    <span class="token comment">// Probably lots of optional fields.</span>
    bar<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">FooBuilder</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">FooBuilder</span> <span class="token punctuation">{</span>
        <span class="token comment">// Set the minimally required fields of Foo.</span>
        <span class="token class-name">FooBuilder</span> <span class="token punctuation">{</span>
            bar<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;X&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">name</span><span class="token punctuation">(</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> bar<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">FooBuilder</span> <span class="token punctuation">{</span>
        <span class="token comment">// Set the name on the builder itself, and return the builder by value.</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>bar <span class="token operator">=</span> bar<span class="token punctuation">;</span>
        <span class="token keyword">self</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// If we can get away with not consuming the Builder here, that is an</span>
    <span class="token comment">// advantage. It means we can use the FooBuilder as a template for constructing many Foos.</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">build</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
        <span class="token comment">// Create a Foo from the FooBuilder, applying all settings in FooBuilder to Foo.</span>
        <span class="token class-name">Foo</span> <span class="token punctuation">{</span> bar<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>bar <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[test]</span>
<span class="token keyword">fn</span> <span class="token function-definition function">builder_test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> foo <span class="token operator">=</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
        bar<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Y&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> foo_from_builder<span class="token punctuation">:</span> <span class="token class-name">Foo</span> <span class="token operator">=</span> <span class="token class-name">FooBuilder</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Y&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>foo<span class="token punctuation">,</span> foo_from_builder<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div><p>Useful when you would otherwise require many different constructors or where construction has side effects.</p><p>This pattern is seen more frequently in Rust (and for simpler objects) than in many other languages because Rust lacks overloading. Since you can only have a single method with a given name, having multiple constructors is less nice in Rust than in C++, Java, or others.</p><h2>16. Compose Structs</h2><p>Sometimes a large struct will cause issues with the borrow checker - although fields can be borrowed independently, sometimes the whole struct ends up being used at once, preventing other uses. A solution might be to decompose the struct into several smaller structs. Then compose these together into the original struct. Then each struct can be borrowed separately and have more flexible behaviour.</p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">A</span> <span class="token punctuation">{</span>
    f1<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
    f2<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
    f3<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">foo</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">A</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token keyword">u32</span> <span class="token punctuation">{</span> <span class="token operator">&amp;</span>a<span class="token punctuation">.</span>f2 <span class="token punctuation">}</span>
<span class="token keyword">fn</span> <span class="token function-definition function">bar</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">A</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">u32</span> <span class="token punctuation">{</span> a<span class="token punctuation">.</span>f1 <span class="token operator">+</span> a<span class="token punctuation">.</span>f3 <span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">baz</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">A</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// The later usage of x causes a to be borrowed for the rest of the function.</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Borrow checker error:</span>
    <span class="token comment">// let y = bar(a); // ~ ERROR: cannot borrow `*a` as mutable more than once at a time</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div><p>We can apply this design pattern and refactor A into two smaller structs, thus solving the borrow checking issue:</p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token comment">// A is now composed of two structs - B and C.</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">A</span> <span class="token punctuation">{</span>
    b<span class="token punctuation">:</span> <span class="token class-name">B</span><span class="token punctuation">,</span>
    c<span class="token punctuation">:</span> <span class="token class-name">C</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">B</span> <span class="token punctuation">{</span>
    f2<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">C</span> <span class="token punctuation">{</span>
    f1<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
    f3<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// These functions take a B or C, rather than A.</span>
<span class="token keyword">fn</span> <span class="token function-definition function">foo</span><span class="token punctuation">(</span>b<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">B</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token keyword">u32</span> <span class="token punctuation">{</span> <span class="token operator">&amp;</span>b<span class="token punctuation">.</span>f2 <span class="token punctuation">}</span>
<span class="token keyword">fn</span> <span class="token function-definition function">bar</span><span class="token punctuation">(</span>c<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">C</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">u32</span> <span class="token punctuation">{</span> c<span class="token punctuation">.</span>f1 <span class="token operator">+</span> c<span class="token punctuation">.</span>f3 <span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">baz</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">A</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> a<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Now it&#x27;s OK!</span>
    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> a<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div><h2>17. Fold Pattern</h2><p>The terms ‘fold’ and ‘folder’ are used in the Rust compiler, although it appears to me to be more like a map than a fold in the usual sense. </p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token comment">// The data we will fold, a simple AST.</span>
<span class="token keyword">mod</span> <span class="token module-declaration namespace">ast</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">Stmt</span> <span class="token punctuation">{</span>
        <span class="token class-name">Expr</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token class-name">Expr</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">Let</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token class-name">Name</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token class-name">Expr</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Name</span> <span class="token punctuation">{</span>
        value<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">Expr</span> <span class="token punctuation">{</span>
        <span class="token class-name">IntLit</span><span class="token punctuation">(</span><span class="token keyword">i64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">Add</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token class-name">Expr</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token class-name">Expr</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">Sub</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token class-name">Expr</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token class-name">Expr</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// The abstract folder</span>
<span class="token keyword">mod</span> <span class="token module-declaration namespace">fold</span> <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token namespace">ast<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

    <span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token class-name">Folder</span> <span class="token punctuation">{</span>
        <span class="token comment">// A leaf node just returns the node itself. In some cases, we can do this</span>
        <span class="token comment">// to inner nodes too.</span>
        <span class="token keyword">fn</span> <span class="token function-definition function">fold_name</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> n<span class="token punctuation">:</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token class-name">Name</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token class-name">Name</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> n <span class="token punctuation">}</span>
        <span class="token comment">// Create a new inner node by folding its children.</span>
        <span class="token keyword">fn</span> <span class="token function-definition function">fold_stmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> s<span class="token punctuation">:</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token class-name">Stmt</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token class-name">Stmt</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">match</span> <span class="token operator">*</span>s <span class="token punctuation">{</span>
                <span class="token class-name">Stmt</span><span class="token punctuation">::</span><span class="token class-name">Expr</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">Stmt</span><span class="token punctuation">::</span><span class="token class-name">Expr</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">fold_expr</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">Stmt</span><span class="token punctuation">::</span><span class="token class-name">Let</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">Stmt</span><span class="token punctuation">::</span><span class="token class-name">Let</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">fold_name</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">fold_expr</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">fn</span> <span class="token function-definition function">fold_expr</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> e<span class="token punctuation">:</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token class-name">Expr</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token class-name">Expr</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">...</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">use</span> <span class="token namespace">fold<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">ast<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token comment">// An example concrete implementation - renames every name to &#x27;foo&#x27;.</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">Renamer</span><span class="token punctuation">;</span>
<span class="token keyword">impl</span> <span class="token class-name">Folder</span> <span class="token keyword">for</span> <span class="token class-name">Renamer</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">fold_name</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> n<span class="token punctuation">:</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token class-name">Name</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token class-name">Name</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">Name</span> <span class="token punctuation">{</span> value<span class="token punctuation">:</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">.</span><span class="token function">to_owned</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Use the default methods for the other nodes.</span>
<span class="token punctuation">}</span></code></pre></div><p>It is common to want to map a data structure by performing some operation on each node in the structure. For simple operations on simple data structures, this can be done using Iterator::map. For more complex operations, perhaps where earlier nodes can affect the operation on later nodes, or where iteration over the data structure is non-trivial, using the fold pattern is more appropriate.</p><p>Like the visitor pattern, the fold pattern allows us to separate traversal of a data structure from the operations performed to each node.</p><p>Mapping data structures in this fashion is common in functional languages. In OO languages, it would be more common to mutate the data structure in place. The ‘functional’ approach is common in Rust, mostly due to the preference for immutability. Using fresh data structures, rather than mutating old ones, makes reasoning about the code easier in most circumstances.</p><h2>18. Newtype</h2><p>Use a tuple struct with a single field to make an opaque wrapper for a type. This creates a new type, rather than an alias to a type (type items).</p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token comment">// Some type, not necessarily in the same module or even crate.</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">Foo</span> <span class="token punctuation">{</span>
    <span class="token comment">//..</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
    <span class="token comment">// These functions are not present on Bar.</span>
    <span class="token comment">//..</span>
<span class="token punctuation">}</span>

<span class="token comment">// The newtype.</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Bar</span><span class="token punctuation">(</span><span class="token class-name">Foo</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">impl</span> <span class="token class-name">Bar</span> <span class="token punctuation">{</span>
    <span class="token comment">// Constructor.</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>
        <span class="token comment">//..</span>
    <span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Bar</span> <span class="token punctuation">{</span>

        <span class="token comment">//..</span>

    <span class="token punctuation">}</span>

    <span class="token comment">//..</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token class-name">Bar</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Foo and Bar are type incompatible, </span>
    <span class="token comment">// the following do not type check.</span>
    <span class="token comment">// let f: Foo = b;</span>
    <span class="token comment">// let b: Bar = Foo { ... };</span>
<span class="token punctuation">}</span></code></pre></div><h2>19. RAII with guards</h2><p>RAII stands for “Resource Acquisition is Initialisation” which is a terrible name. The essence of the pattern is that resource initialisation is done in the constructor of an object and finalisation in the destructor. This pattern is extended in Rust by using an RAII object as a guard of some resource and relying on the type system to ensure that access is always mediated by the guard object.</p><p>Mutex guards are the classic example of this pattern from the std library (this is a simplified version of the real implementation):</p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span></span><span class="token class-name">Deref</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token type-definition class-name">Foo</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token type-definition class-name">Mutex</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// We keep a reference to our data: T here.</span>
    <span class="token comment">//..</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token type-definition class-name">MutexGuard</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#x27;a</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token lifetime-annotation symbol">&#x27;a</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    data<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#x27;a</span> <span class="token class-name">T</span><span class="token punctuation">,</span>
    <span class="token comment">//..</span>
<span class="token punctuation">}</span>

<span class="token comment">// Locking the mutex is explicit.</span>
<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">Mutex</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">MutexGuard</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// Lock the underlying OS mutex.</span>
        <span class="token comment">//..</span>

        <span class="token comment">// MutexGuard keeps a reference to self</span>
        <span class="token class-name">MutexGuard</span> <span class="token punctuation">{</span>
            data<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">,</span>
            <span class="token comment">//..</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Destructor for unlocking the mutex.</span>
<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#x27;a</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">Drop</span> <span class="token keyword">for</span> <span class="token class-name">MutexGuard</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#x27;a</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">drop</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Unlock the underlying OS mutex.</span>
        <span class="token comment">//..</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Implementing Deref means we can treat MutexGuard like a pointer to T.</span>
<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#x27;a</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">Deref</span> <span class="token keyword">for</span> <span class="token class-name">MutexGuard</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#x27;a</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">type</span> <span class="token class-name">Target</span> <span class="token operator">=</span> <span class="token class-name">T</span><span class="token punctuation">;</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">deref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token class-name">T</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>data
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">baz</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token class-name">Mutex</span><span class="token operator">&lt;</span><span class="token class-name">Foo</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> xx <span class="token operator">=</span> x<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xx<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// foo is a method on Foo.</span>
    <span class="token comment">// The borrow checker ensures we can&#x27;t store a reference to the </span>
    <span class="token comment">// underlying Foo which will outlive the guard xx.</span>

    <span class="token comment">// x is unlocked when we exit this function </span>
    <span class="token comment">// and xx&#x27;s destructor is executed.</span>
<span class="token punctuation">}</span></code></pre></div><p>Where a resource must be finalised after use, RAII can be used to do this finalisation. If it is an error to access that resource after finalisation, then this pattern can be used to prevent such errors.</p><h2>20. Strategy Pattern</h2><p>The Strategy design pattern is a technique that enables separation of concerns. It also allows to decouple software modules through Dependency Inversion.</p><p>The basic idea behind the Strategy pattern is that, given an algorithm solving a particular problem, we define only the skeleton of the algorithm at an abstract level and we separate the specific algorithm’s implementation into different parts.</p><p>In this way, a client using the algorithm may choose a specific implementation, while the general algorithm workflow remains the same. In other words, the abstract specification of the class does not depend on the specific implementation of the derived class, but specific implementation must adhere to the abstract specification. This is why we call it “Dependency Inversion”.</p><p>In this example our invariants (or abstractions) are Context, Formatter, and Report, while Text and Json are our strategy structs. These strategies have to implement the Formatter trait.</p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">Data</span> <span class="token operator">=</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">u32</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">trait</span> <span class="token class-name">Formatter</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">format</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> data<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Data</span><span class="token punctuation">,</span> s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token type-definition class-name">Report</span><span class="token punctuation">;</span>

<span class="token keyword">impl</span> <span class="token class-name">Report</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">generate</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Formatter</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>g<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span> s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// backend operations...</span>
        <span class="token keyword">let</span> <span class="token keyword">mut</span> data <span class="token operator">=</span> <span class="token class-name">HashMap</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        data<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">&quot;one&quot;</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        data<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">&quot;two&quot;</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// generate report</span>
        g<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>data<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token type-definition class-name">Text</span><span class="token punctuation">;</span>
<span class="token keyword">impl</span> <span class="token class-name">Formatter</span> <span class="token keyword">for</span> <span class="token class-name">Text</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">format</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> data<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Data</span><span class="token punctuation">,</span> s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token operator">*</span>s <span class="token operator">=</span> data
            <span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">&quot;{} {}\n&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token type-definition class-name">Json</span><span class="token punctuation">;</span>
<span class="token keyword">impl</span> <span class="token class-name">Formatter</span> <span class="token keyword">for</span> <span class="token class-name">Json</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">format</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> data<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Data</span><span class="token punctuation">,</span> s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;[&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> <span class="token keyword">mut</span> iter <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> entry <span class="token operator">=</span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">r#&quot;{{&quot;{}&quot;:&quot;{}&quot;}}&quot;#</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
            s<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                s<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token char string">&#x27;,&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">let</span> entry <span class="token operator">=</span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">r#&quot;{{&quot;{}&quot;:&quot;{}&quot;}}&quot;#</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
                s<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        s<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token char string">&#x27;]&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Report</span><span class="token punctuation">::</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">assert!</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;one 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">assert!</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;two 2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Report</span><span class="token punctuation">::</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token class-name">Json</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">assert!</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">r#&quot;{&quot;one&quot;:&quot;1&quot;}&quot;#</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">assert!</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">r#&quot;{&quot;two&quot;:&quot;2&quot;}&quot;#</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div><p>The main advantage is separation of concerns. For example, in this case Report does not know anything about specific implementations of Json and Text, whereas the output implementations does not care about how data is preprocessed, stored, and fetched. The only thing they have to know is context and a specific trait and method to implement, i.e,Formatter and run.</p><p>However, we don’t need to use traits in order to design this pattern in Rust. The following toy example demonstrates the idea of the Strategy pattern using Rust closures:</p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">Adder</span><span class="token punctuation">;</span>
<span class="token keyword">impl</span> <span class="token class-name">Adder</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">add</span><span class="token operator">&lt;</span><span class="token class-name">F</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token class-name">F</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">u8</span>
    <span class="token keyword">where</span>
        <span class="token class-name">F</span><span class="token punctuation">:</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token keyword">u8</span><span class="token punctuation">,</span> <span class="token keyword">u8</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">u8</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> arith_adder <span class="token operator">=</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>x<span class="token punctuation">,</span> y<span class="token closure-punctuation punctuation">|</span></span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
    <span class="token keyword">let</span> bool_adder <span class="token operator">=</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>x<span class="token punctuation">,</span> y<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> x <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">||</span> y <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">{</span>
            <span class="token number">1</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token number">0</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> custom_adder <span class="token operator">=</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>x<span class="token punctuation">,</span> y<span class="token closure-punctuation punctuation">|</span></span> <span class="token number">2</span> <span class="token operator">*</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>

    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token class-name">Adder</span><span class="token punctuation">::</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> arith_adder<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">Adder</span><span class="token punctuation">::</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> bool_adder<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token class-name">Adder</span><span class="token punctuation">::</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> custom_adder<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div><h2>21. Visitor Pattern</h2><p>A visitor encapsulates an algorithm that operates over a heterogeneous collection of objects. It allows multiple different algorithms to be written over the same data without having to modify the data (or their primary behaviour).</p><p>Furthermore, the visitor pattern allows separating the traversal of a collection of objects from the operations performed on each object.</p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token comment">// The data we will visit</span>
<span class="token keyword">mod</span> <span class="token module-declaration namespace">ast</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">Stmt</span> <span class="token punctuation">{</span>
        <span class="token class-name">Expr</span><span class="token punctuation">(</span><span class="token class-name">Expr</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">Let</span><span class="token punctuation">(</span><span class="token class-name">Name</span><span class="token punctuation">,</span> <span class="token class-name">Expr</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Name</span> <span class="token punctuation">{</span>
        value<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">Expr</span> <span class="token punctuation">{</span>
        <span class="token class-name">IntLit</span><span class="token punctuation">(</span><span class="token keyword">i64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">Add</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token class-name">Expr</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token class-name">Expr</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">Sub</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token class-name">Expr</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token class-name">Expr</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// The abstract visitor</span>
<span class="token keyword">mod</span> <span class="token module-declaration namespace">visit</span> <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token namespace">ast<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

    <span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token class-name">Visitor</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">fn</span> <span class="token function-definition function">visit_name</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> n<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Name</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">T</span><span class="token punctuation">;</span>
        <span class="token keyword">fn</span> <span class="token function-definition function">visit_stmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Stmt</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">T</span><span class="token punctuation">;</span>
        <span class="token keyword">fn</span> <span class="token function-definition function">visit_expr</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> e<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Expr</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">T</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">use</span> <span class="token namespace">visit<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">ast<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token comment">// An example concrete implementation - walks the AST interpreting it as code.</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">Interpreter</span><span class="token punctuation">;</span>
<span class="token keyword">impl</span> <span class="token class-name">Visitor</span><span class="token operator">&lt;</span><span class="token keyword">i64</span><span class="token operator">&gt;</span> <span class="token keyword">for</span> <span class="token class-name">Interpreter</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">visit_name</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> n<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Name</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">i64</span> <span class="token punctuation">{</span> <span class="token macro property">panic!</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">visit_stmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Stmt</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">i64</span> <span class="token punctuation">{</span>
        <span class="token keyword">match</span> <span class="token operator">*</span>s <span class="token punctuation">{</span>
            <span class="token class-name">Stmt</span><span class="token punctuation">::</span><span class="token class-name">Expr</span><span class="token punctuation">(</span><span class="token keyword">ref</span> e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">visit_expr</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">Stmt</span><span class="token punctuation">::</span><span class="token class-name">Let</span><span class="token punctuation">(</span><span class="token punctuation">..</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token macro property">unimplemented!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">visit_expr</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> e<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Expr</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">i64</span> <span class="token punctuation">{</span>
        <span class="token keyword">match</span> <span class="token operator">*</span>e <span class="token punctuation">{</span>
            <span class="token class-name">Expr</span><span class="token punctuation">::</span><span class="token class-name">IntLit</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> n<span class="token punctuation">,</span>
            <span class="token class-name">Expr</span><span class="token punctuation">::</span><span class="token class-name">Add</span><span class="token punctuation">(</span><span class="token keyword">ref</span> lhs<span class="token punctuation">,</span> <span class="token keyword">ref</span> rhs<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">visit_expr</span><span class="token punctuation">(</span>lhs<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">visit_expr</span><span class="token punctuation">(</span>rhs<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">Expr</span><span class="token punctuation">::</span><span class="token class-name">Sub</span><span class="token punctuation">(</span><span class="token keyword">ref</span> lhs<span class="token punctuation">,</span> <span class="token keyword">ref</span> rhs<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">visit_expr</span><span class="token punctuation">(</span>lhs<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">visit_expr</span><span class="token punctuation">(</span>rhs<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><p>One could implement further visitors, for example a type checker, without having to modify the AST data.</p><p>The visitor pattern is useful anywhere that you want to apply an algorithm to heterogeneous data. If data is homogeneous, you can use an iterator-like pattern. Using a visitor object (rather than a functional approach) allows the visitor to be stateful and thus communicate information between nodes.</p><p>The visitor pattern is a common pattern in most OO languages. The fold pattern is similar to visitor but produces a new version of the visited data structure.</p><blockquote><p>Notes from <a href="https://rust-unofficial.github.io/patterns">https://rust-unofficial.github.io/patterns</a></p></blockquote></article><div class="utterances" style="top:50px"></div></div></div></main><footer class="css-1wvahdb e1v9gu3l0"><style data-emotion-css="voneje">.css-voneje{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:100%;}</style><style data-emotion-css="1u3kyku">.css-1u3kyku{position:relative;margin-left:auto;margin-right:auto;width:auto;max-width:40em;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:100%;}</style><div class="e1v9gu3l1 css-1u3kyku eqdtqc0"><style data-emotion-css="19sj128">.css-19sj128{color:rgba(0,0,0,0.54);font-size:0.8rem;}.css-19sj128:hover,.css-19sj128:focus{-webkit-text-decoration:none;text-decoration:none;}</style><a class="css-19sj128 e1v9gu3l2" href="/about">Copyright © <!-- -->2021<!-- --> <!-- -->raptazure<!-- -->. Built with Gatsby.</a></div></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-128956609-1"></script><script>
    window.GATSBY_GTAG_PLUGIN_GA_TRACKING_ID = (
      'UA-128956609-1'
    );
    window.GATSBY_GTAG_PLUGIN_ANONYMIZE = true;

    var options = {
      send_page_view: false
    };
    if (true) {
      options.anonymize_ip = true;
    }

    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    window.gtag = gtag;
    gtag('js', new Date());
    gtag('config', 'UA-128956609-1', options);
  </script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/rust-patterns/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-d47b21a5737d9524fa70.js"],"app":["/app-88d13f99ef23aa1fa235.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-b0556ce5127c1a3e2490.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-05bc7059d2ca310545bc.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-37e49d4d281d1d07662a.js"],"component---src-pages-journal-tsx":["/component---src-pages-journal-tsx-ec5bcdbf97fe66b0fc2f.js"],"component---src-templates-about-tsx":["/component---src-templates-about-tsx-0bab51d3a6868f638222.js"],"component---src-templates-journal-tsx":["/component---src-templates-journal-tsx-7c6af881d3e35865333c.js"],"component---src-templates-post-tsx":["/component---src-templates-post-tsx-a8605c1ce88d408d0128.js"]};/*]]>*/</script><script src="/polyfill-d47b21a5737d9524fa70.js" nomodule=""></script><script src="/component---src-templates-post-tsx-a8605c1ce88d408d0128.js" async=""></script><script src="/e30115b4d33dc6d7723ba506c53f6f70ec229815-7037690d8a5360ce8426.js" async=""></script><script src="/styles-407fe62976dc5310c43e.js" async=""></script><script src="/app-88d13f99ef23aa1fa235.js" async=""></script><script src="/framework-305b3707783ccc9d7ca6.js" async=""></script><script src="/webpack-runtime-1759ea2bc116b1543164.js" async=""></script></body></html>